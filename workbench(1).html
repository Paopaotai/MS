<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能客服销售系统（迭代版）</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#FF4D4F',
            neutral: {
              100: '#F5F5F5',
              200: '#E5E5E5',
              300: '#D4D4D4',
              400: '#A3A3A3',
              500: '#737373',
              600: '#525252',
              700: '#404040',
              800: '#262626',
              900: '#171717',
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px -8px rgba(0, 0, 0, 0.08);
      }
      .tab-active {
        @apply text-primary border-primary font-medium;
      }
      .switch-checkbox:checked {
        @apply right-0 border-green-400;
        right: 0;
        border-color: #68D391;
      }
      .switch-checkbox:checked + .switch-label {
        @apply bg-green-400;
      }
      /* 侧边栏TAB切换样式 */
      .sidebar-tab-btn {
        transition: all 0.2s ease;
      }
      .sidebar-tab-btn.active {
        border-bottom-color: #165DFF;
        color: #165DFF;
      }
      .sidebar-tab-content {
        display: block;
      }
      .sidebar-tab-content.hidden {
        display: none;
      }
      /* AI任务分支流程样式 */
      .ai-task-flow {
        max-height: 400px;
        overflow-y: auto;
        scrollbar-width: thin;
        position: relative;
        padding-left: 3rem;
      }
      /* 节点进度轴 - 左边竖条带节点标号 */
      .progress-axis-line {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(to bottom, 
          #165DFF 0%, 
          #165DFF var(--progress-height, 0%), 
          #E5E5E5 var(--progress-height, 0%), 
          #E5E5E5 100%);
        transition: background 0.3s ease;
      }
      .node-marker {
        position: absolute;
        left: -0.625rem;
        width: 1.25rem;
        height: 1.25rem;
        border-radius: 50%;
        border: 2px solid white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.625rem;
        font-weight: bold;
        z-index: 10;
        transition: all 0.3s ease;
      }
      .node-marker.completed {
        background-color: #52C41A;
        color: white;
      }
      .node-marker.active {
        background-color: #165DFF;
        color: white;
        box-shadow: 0 0 0 4px rgba(22, 93, 255, 0.2);
        animation: pulse-marker 2s infinite;
      }
      .node-marker.stuck {
        background-color: #FAAD14;
        color: white;
      }
      .node-marker.pending {
        background-color: #E5E5E5;
        color: #737373;
      }
      @keyframes pulse-marker {
        0%, 100% {
          box-shadow: 0 0 0 4px rgba(22, 93, 255, 0.2);
        }
        50% {
          box-shadow: 0 0 0 8px rgba(22, 93, 255, 0);
        }
      }
      .degree-section {
        margin-bottom: 1.5rem;
        position: relative;
      }
      .degree-header {
        @apply flex items-center gap-2 mb-2 text-xs;
      }
      .degree-badge {
        @apply px-2 py-0.5 bg-primary/10 text-primary rounded font-medium;
      }
      .degree-title {
        @apply text-neutral-600 font-medium;
      }
      .node-container {
        @apply relative;
        margin-left: 0.5rem;
      }
      .node-result-summary {
        @apply mt-2 p-2 bg-neutral-50 rounded text-xs text-neutral-600;
        border-left: 2px solid #165DFF;
      }
      .flow-node {
        @apply flex items-start gap-2 p-2 bg-white border rounded-lg mb-2 transition-all;
        min-height: 48px;
      }
      .flow-node.node-completed {
        @apply border-green-200 bg-green-50/50;
      }
      .flow-node.node-active {
        @apply border-primary shadow-sm;
        animation: pulse-border 2s infinite;
      }
      .flow-node.node-pending {
        @apply border-neutral-200 bg-neutral-50/50;
      }
      .flow-node.node-stuck {
        @apply border-warning shadow-md bg-warning/5;
      }
      .node-icon {
        @apply w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 text-sm;
      }
      .node-content {
        @apply flex-1 min-w-0;
      }
      .node-title {
        @apply text-xs font-medium text-neutral-800 mb-0.5;
      }
      .node-status {
        @apply text-xs;
      }
      .node-badge {
        @apply inline-block px-1.5 py-0.5 bg-neutral-100 text-neutral-600 text-xs rounded mt-1;
      }
      .flow-arrow {
        @apply flex justify-center py-1 text-neutral-400;
      }
      .flow-branches {
        @apply flex flex-wrap gap-2 mt-2;
      }
      .branch-node {
        @apply flex items-start gap-2 p-1.5 bg-white border rounded text-xs;
        flex: 1 1 calc(50% - 0.5rem);
        min-width: 100px;
      }
      .branch-node .node-icon {
        @apply w-6 h-6 text-xs;
      }
      .branch-node .node-title {
        @apply text-xs;
      }
      @keyframes pulse-border {
        0%, 100% {
          box-shadow: 0 0 0 0 rgba(22, 93, 255, 0.4);
        }
        50% {
          box-shadow: 0 0 0 4px rgba(22, 93, 255, 0);
        }
      }
      .active-task-mode {
        @apply bg-primary/10 text-primary font-medium;
      }
      /* 标签筛选按钮激活状态 */
      .filter-tag-btn.active-tag {
        @apply font-semibold;
        transform: scale(1.05);
      }
      .filter-tag-btn[data-tag="high-value"].active-tag {
        @apply bg-success text-white border-success;
      }
      .filter-tag-btn[data-tag="high-intent"].active-tag {
        @apply bg-danger text-white border-danger;
      }
      .filter-tag-btn[data-tag="medium-value"].active-tag {
        @apply bg-warning text-white border-warning;
      }
      .filter-tag-btn[data-tag="medium-intent"].active-tag {
        @apply bg-warning text-white border-warning;
      }
      .filter-tag-btn[data-tag="low-value"].active-tag {
        @apply bg-primary text-white border-primary;
      }
      .filter-tag-btn[data-tag="low-intent"].active-tag {
        @apply bg-primary text-white border-primary;
      }
      /* AI标签小标号样式 */
      .tag-with-ai {
        position: relative;
      }
      .tag-ai-badge {
        position: absolute;
        top: -4px;
        right: -4px;
        width: 14px;
        height: 14px;
        background-color: #165DFF;
        color: white;
        border-radius: 50%;
        font-size: 8px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-neutral-800">
  <!-- 导航栏 -->
  <header class="sticky top-0 z-50 bg-white shadow-sm">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <i class="fa fa-comments text-primary text-2xl mr-2"></i>
          <span class="text-xl font-semibold text-primary">智能客服销售系统</span>
        </div>
        <nav class="hidden md:block">
          <ul class="flex space-x-8">
            <li><a href="#overview" class="text-neutral-600 hover:text-primary transition-colors">产品概述</a></li>
            <li><a href="#sidebar" class="text-neutral-600 hover:text-primary transition-colors">客户详情侧边栏</a></li>
            <li><a href="#backend" class="text-neutral-600 hover:text-primary transition-colors">客户管理后台</a></li>
            <li><a href="#workflow" class="text-neutral-600 hover:text-primary transition-colors">交互流程</a></li>
          </ul>
        </nav>
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-neutral-600 hover:text-primary">
            <i class="fa fa-bars text-xl"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="hidden md:hidden bg-white shadow-md">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        <a href="#overview" class="block px-3 py-2 text-neutral-600 hover:bg-primary/10 hover:text-primary rounded-md">产品概述</a>
        <a href="#sidebar" class="block px-3 py-2 text-neutral-600 hover:bg-primary/10 hover:text-primary rounded-md">客户详情侧边栏</a>
        <a href="#backend" class="block px-3 py-2 text-neutral-600 hover:bg-primary/10 hover:text-primary rounded-md">客户管理后台</a>
        <a href="#workflow" class="block px-3 py-2 text-neutral-600 hover:bg-primary/10 hover:text-primary rounded-md">交互流程</a>
      </div>
    </div>
  </header>

  <!-- 英雄区域 -->
  <section class="bg-gradient-to-r from-primary to-primary/80 text-white py-16 md:py-24">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">智能客服销售系统</h1>
        <p class="text-xl md:text-2xl opacity-90 mb-8">精准客户画像 · 高效人机协作 · 智能运营管理</p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <a href="#sidebar" class="bg-white text-primary font-medium px-6 py-3 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
            查看客户详情
          </a>
          <a href="#backend" class="bg-white/20 backdrop-blur-sm text-white font-medium px-6 py-3 rounded-lg hover:bg-white/30 transition-colors">
            进入管理后台
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- 产品概述 -->
  <section id="overview" class="py-16 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-3xl font-bold text-center mb-12 text-neutral-800">产品核心价值</h2>
        
        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-neutral-50 rounded-xl p-6 shadow-sm card-hover">
            <div class="text-primary text-2xl mb-4">
              <i class="fa fa-user-circle-o"></i>
            </div>
            <h3 class="text-xl font-semibold mb-3">精准客户画像</h3>
            <p class="text-neutral-700 text-sm">
              整合多维度客户标签（意向/价值/行为/属性），AI实时更新画像，助力精准运营
            </p>
          </div>
          
          <div class="bg-neutral-50 rounded-xl p-6 shadow-sm card-hover">
            <div class="text-primary text-2xl mb-4">
              <i class="fa fa-robot"></i>
            </div>
            <h3 class="text-xl font-semibold mb-3">可控人机协作</h3>
            <p class="text-neutral-700 text-sm">
              分级任务机制+可配置AI规则，实现80%重复工作自动化，人力聚焦高价值转化
            </p>
          </div>
          
          <div class="bg-neutral-50 rounded-xl p-6 shadow-sm card-hover">
            <div class="text-primary text-2xl mb-4">
              <i class="fa fa-line-chart"></i>
            </div>
            <h3 class="text-xl font-semibold mb-3">智能运营管理</h3>
            <p class="text-neutral-700 text-sm">
              群体分层管理+自动化流程，支撑带班量从300→500+，转化效率提升30%+
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 客户详情侧边栏（核心界面1） -->
  <section id="sidebar" class="py-16 bg-neutral-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-center mb-4 text-neutral-800">客户详情侧边栏</h2>
      <p class="text-center text-neutral-600 mb-12 max-w-3xl mx-auto">
        实时客户画像+学习数据+AI分析，辅助精准沟通决策
      </p>
      
      <!-- 界面原型（支持交互） -->
      <div class="max-w-6xl mx-auto mb-16">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-neutral-200">
          <!-- 聊天界面与侧边栏组合 -->
          <div class="flex flex-col lg:flex-row">
            <!-- 模拟聊天窗口 -->
            <div class="w-full lg:w-3/4 border-r border-neutral-200">
              <div class="p-4 border-b border-neutral-200 bg-neutral-50">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary">
                    <i class="fa fa-user"></i>
                  </div>
                  <div class="ml-3">
                    <h3 class="font-medium">张同学</h3>
                    <p class="text-sm text-neutral-500">在线 · 最后活跃：1分钟前</p>
                  </div>
                </div>
              </div>
              
              <div class="p-4 h-96 overflow-y-auto scrollbar-hide bg-neutral-50/50">
                <!-- 聊天记录 -->
                <div class="flex mb-4">
                  <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary text-sm flex-shrink-0">
                    <i class="fa fa-user"></i>
                  </div>
                  <div class="ml-2 bg-white rounded-lg rounded-tl-none px-4 py-2 shadow-sm max-w-xs">
                    你好，我想了解Python进阶班的具体课程内容
                  </div>
                </div>
                
                <div class="flex justify-end mb-4">
                  <div class="bg-primary text-white rounded-lg rounded-tr-none px-4 py-2 shadow-sm max-w-xs">
                    进阶班包含数据分析、机器学习入门和项目实战三个模块，需要给你发详细大纲吗？
                  </div>
                </div>
                
                <div class="flex mb-4">
                  <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary text-sm flex-shrink-0">
                    <i class="fa fa-user"></i>
                  </div>
                  <div class="ml-2 bg-white rounded-lg rounded-tl-none px-4 py-2 shadow-sm max-w-xs">
                    好的，另外想问下有没有适合大学生的优惠？
                  </div>
                </div>
              </div>
              
              <div class="p-4 border-t border-neutral-200">
                <div class="flex">
                  <input type="text" placeholder="输入消息..." class="flex-1 border border-neutral-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                  <button class="bg-primary text-white px-4 rounded-r-lg hover:bg-primary/90 transition-colors">
                    <i class="fa fa-paper-plane"></i>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- 客户详情侧边栏（优化后） -->
            <div class="w-full lg:w-1/4 bg-white max-h-screen overflow-y-auto scrollbar-hide">
              <!-- TAB切换 -->
              <div class="sticky top-0 bg-white border-b border-neutral-200 z-10">
                <div class="flex">
                  <button class="flex-1 px-4 py-3 text-sm font-medium border-b-2 border-primary text-primary sidebar-tab-btn active" data-sidebar-tab="profile">
                    客户画像
                  </button>
                  <button class="flex-1 px-4 py-3 text-sm font-medium border-b-2 border-transparent text-neutral-500 hover:text-neutral-700 sidebar-tab-btn" data-sidebar-tab="ai-assistant">
                    AI助手
                  </button>
                  </div>
                  </div>
              
              <!-- 客户画像TAB -->
              <div id="sidebar-profile-tab" class="sidebar-tab-content">
                <!-- 1. 客户基础画像区（简化版） -->
                <div class="p-3 border-b border-neutral-200">
                <div class="flex items-start justify-between mb-2">
                  <h3 class="font-semibold text-neutral-800 text-sm">客户信息</h3>
                  <button class="text-xs text-neutral-500 hover:text-primary flex items-center">
                    <i class="fa fa-refresh mr-1"></i> 刷新
                  </button>
                </div>
                
                <!-- 头像和基本信息（只显示：名称、备注、称呼、流利号） -->
                <div class="flex items-start">
                  <div class="w-10 h-10 bg-primary flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-user text-white text-sm"></i>
                  </div>
                  <div class="ml-2 flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      <p class="font-medium text-sm">佳豪</p>
                  </div>
                    
                    <!-- 备注 -->
                    <div class="flex items-center justify-between group mb-1 text-xs">
                      <span class="text-neutral-500 w-10 flex-shrink-0">备注：</span>
                      <div class="flex-1 flex items-center gap-1 hover:bg-neutral-50 px-1.5 py-0.5 rounded">
                        <span class="text-neutral-800">佳豪哟哟吆</span>
                        <button class="text-neutral-400 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                          <i class="fa fa-pencil"></i>
                        </button>
                  </div>
                    </div>
                    
                    <!-- 称呼 -->
                    <div class="flex items-center justify-between group mb-1 text-xs">
                      <span class="text-neutral-500 w-10 flex-shrink-0">称呼：</span>
                      <div class="flex-1 flex items-center gap-1 hover:bg-neutral-50 px-1.5 py-0.5 rounded">
                        <span class="text-neutral-800">神马</span>
                        <button class="text-neutral-400 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </div>
                    </div>
                    
                    <!-- 流利号 -->
                    <div class="flex items-center gap-2 text-xs">
                      <span class="text-neutral-500">流利号：</span>
                      <span class="text-neutral-400">379516893</span>
                      <button class="text-neutral-400 hover:text-primary" title="复制ID">
                        <i class="fa fa-copy"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 2. 客户标签区 -->
              <div class="p-4 border-b border-neutral-200">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="font-semibold text-neutral-800">客户标签</h3>
                  <button class="text-xs text-primary flex items-center hover:underline">
                    <i class="fa fa-edit mr-1"></i> 编辑
                  </button>
                </div>
                
                <!-- 核心标签（优先显示，意向分大一点） -->
                <div class="mb-4">
                  <div class="flex flex-wrap gap-2 items-center">
                    <span class="px-3 py-1 bg-primary/10 text-primary text-sm rounded-full font-semibold">
                      意向分：<span class="text-base">85</span>
                      </span>
                    <span class="px-2 py-1 bg-success/10 text-success text-xs rounded-full font-medium">
                        高价值
                      </span>
                    <span class="px-2 py-1 bg-danger/10 text-danger text-xs rounded-full font-medium">
                      高意向
                      </span>
                    </div>
                  </div>
                
                <!-- 系统标签（不支持修改） -->
                <div class="mb-4">
                  <span class="text-xs text-neutral-500 block mb-2">系统标签</span>
                  <div class="flex flex-wrap gap-2">
                    <span class="px-2 py-1 bg-indigo-50 text-indigo-700 text-xs rounded-full">上班族</span>
                    <span class="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full">新一线</span>
                    <span class="px-2 py-1 bg-pink-50 text-pink-700 text-xs rounded-full">♀ 女</span>
                    <span class="px-2 py-1 bg-green-50 text-green-700 text-xs rounded-full">中高</span>
                    <span class="px-2 py-1 bg-purple-50 text-purple-700 text-xs rounded-full">轻奢型</span>
                    <span class="px-2 py-1 bg-orange-50 text-orange-700 text-xs rounded-full">英语学习</span>
                </div>
              </div>
              
                <!-- AI标签（支持修改） -->
                <div class="mb-4">
                  <span class="text-xs text-neutral-500 block mb-1.5">AI标签</span>
                  <div class="grid grid-cols-2 gap-x-2 gap-y-1 text-xs">
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">身份：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">学生</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">诉求：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">工作需要</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">场景：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">职场沟通</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">痛点：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">时间有限</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">目标：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">出国游</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">时段：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">晚上</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">时间：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">6个月</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                  </div>
                    <div class="flex items-center gap-1.5 group">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">工作行业：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">互联网</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                        </button>
                      </span>
                </div>
                    <div class="flex items-center gap-1.5 group col-span-2">
                      <span class="text-neutral-500 w-14 flex-shrink-0 text-xs">是否外企：</span>
                      <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 rounded flex items-center gap-1 flex-1 text-xs">
                        <span class="flex-1 min-w-0 truncate">是</span>
                        <button class="text-blue-400 hover:text-blue-600 flex-shrink-0 text-xs" title="编辑">
                          <i class="fa fa-pencil"></i>
                </button>
                      </span>
                    </div>
                  </div>
              </div>
              
                <!-- 手工标签（支持修改） -->
                <div>
                  <span class="text-xs text-neutral-500 block mb-2">手工标签</span>
                  <div class="flex flex-wrap gap-2">
                    <span class="px-2 py-1 bg-neutral-100 text-neutral-700 text-xs rounded-full flex items-center gap-1 relative">
                      1 X
                      <button class="text-neutral-400 hover:text-neutral-600 text-xs ml-1">×</button>
                    </span>
                    <span class="px-2 py-1 bg-neutral-100 text-neutral-700 text-xs rounded-full flex items-center gap-1 relative">
                      10 X
                      <button class="text-neutral-400 hover:text-neutral-600 text-xs ml-1">×</button>
                    </span>
                    <span class="px-2 py-1 bg-neutral-100 text-neutral-700 text-xs rounded-full flex items-center gap-1 relative">
                      100 X
                      <button class="text-neutral-400 hover:text-neutral-600 text-xs ml-1">×</button>
                    </span>
                    <span class="px-2 py-1 bg-neutral-100 text-neutral-700 text-xs rounded-full flex items-center gap-1 relative">
                      10000 X
                      <button class="text-neutral-400 hover:text-neutral-600 text-xs ml-1">×</button>
                    </span>
                    <button class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full hover:bg-primary/20">
                      <i class="fa fa-plus mr-1"></i>添加
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- 3. 客户学习情况（整合课程、PT、学习数据） -->
              <div class="p-4 border-b border-neutral-200">
                <h3 class="font-semibold text-neutral-800 mb-3">学习情况</h3>
                
                <!-- PT测试等级（最上面） -->
                <div class="mb-3 pb-3 border-b border-neutral-100">
                  <div class="bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-2">
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-xs text-neutral-500">PT测试等级</span>
                      <span class="text-xs text-neutral-500">2025-10-11</span>
                    </div>
                    <div class="flex items-baseline gap-1">
                      <span class="text-lg font-bold text-primary">65</span>
                      <span class="text-xs text-neutral-600">分</span>
                      <span class="px-1.5 py-0.5 bg-primary/20 text-primary text-xs rounded ml-2">Lv3</span>
                    </div>
                  </div>
                </div>
                
                <!-- 课程和服务信息（紧凑排列） -->
                <div class="mb-3 pb-3 border-b border-neutral-100">
                  <div class="grid grid-cols-3 gap-2 text-xs">
                    <div class="flex flex-col">
                      <span class="text-neutral-500 mb-0.5">生效课程</span>
                      <span class="text-neutral-800 font-medium">3</span>
                    </div>
                    <div class="flex flex-col">
                      <span class="text-neutral-500 mb-0.5">班级服务</span>
                      <span class="text-neutral-800 font-medium">4</span>
                    </div>
                    <div class="flex flex-col col-span-3">
                      <span class="text-neutral-500 mb-0.5">已购课程</span>
                      <span class="text-neutral-700 leading-relaxed">懂你英语®A+ Club小班课 (含2K奖学金) (阅读版) L3-L4</span>
                    </div>
                  </div>
                </div>
                
                <!-- 学习目标（原学习兴趣） -->
                <div class="mb-4 pb-3 border-b border-neutral-100">
                  <div class="flex items-start text-xs mb-1.5">
                    <span class="text-neutral-500 w-16 flex-shrink-0">学习目标：</span>
                    <div class="flex-1 flex flex-wrap gap-1.5">
                      <span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded-full">出国游</span>
                    </div>
                  </div>
                </div>
                
                <!-- APP活跃情况 -->
                <div class="mb-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-neutral-600">APP活跃情况</span>
                    <span class="px-2 py-0.5 bg-success/10 text-success text-xs rounded-full">活跃</span>
                  </div>
                  <div class="space-y-1.5 text-xs mb-2">
                    <div class="flex items-center gap-2">
                      <span class="w-2 h-2 rounded-full bg-green-500"></span>
                      <span class="text-neutral-600">流利阅读</span>
                      <span class="text-neutral-400 ml-auto">2025-10-15 访问</span>
                    </div>
                  </div>
                  <div class="w-full bg-neutral-200 rounded-full h-2">
                    <div class="bg-success h-2 rounded-full" style="width: 75%"></div>
                  </div>
                  <div class="text-xs text-neutral-500 mt-1">
                    近7天活跃4天 · 最近学习：2025-10-15 10:56:37
                  </div>
                </div>
                
                <!-- 学习模块图标 -->
                <div class="flex items-center gap-3 mb-4 pb-3 border-b border-neutral-100">
                  <div class="flex flex-col items-center gap-1">
                    <div class="w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center">
                      <i class="fa fa-wave text-green-600 text-xs"></i>
                    </div>
                    <span class="text-xs text-neutral-600">懂你A+</span>
                  </div>
                  <div class="flex flex-col items-center gap-1">
                    <div class="w-8 h-8 rounded-lg bg-orange-100 flex items-center justify-center">
                      <i class="fa fa-book text-orange-600 text-xs"></i>
                    </div>
                    <span class="text-xs text-neutral-600">流利阅读</span>
                  </div>
                  <div class="flex flex-col items-center gap-1">
                    <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center">
                      <i class="fa fa-microphone text-purple-600 text-xs"></i>
                    </div>
                    <span class="text-xs text-neutral-600">地道发音</span>
                  </div>
                </div>
                
                <!-- 近7日学习数据（网格布局） -->
                <div class="mb-4">
                  <h4 class="text-xs font-medium text-neutral-700 mb-2">近7日学习数据</h4>
                  <div class="grid grid-cols-3 gap-2 text-xs">
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">今日学习</div>
                      <div class="text-sm font-semibold text-neutral-800">0分钟</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">昨日学习</div>
                      <div class="text-sm font-semibold text-neutral-800">44.7分钟</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">课程进度</div>
                      <div class="text-sm font-semibold text-primary">L3-M2 23%</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">答题正确率</div>
                      <div class="text-sm font-semibold text-success">82.1%</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">听原音比例</div>
                      <div class="text-sm font-semibold text-neutral-800">0%</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">录音比例</div>
                      <div class="text-sm font-semibold text-neutral-800">0%</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">七日学习天数</div>
                      <div class="text-sm font-semibold text-neutral-800">4天</div>
                    </div>
                    <div class="bg-neutral-50 rounded p-2">
                      <div class="text-neutral-500 mb-0.5">完课数</div>
                      <div class="text-sm font-semibold text-primary">14</div>
                    </div>
                    <div class="bg-green-50 rounded p-2 border border-green-200">
                      <div class="text-green-700 text-xs font-medium">七日连续学习</div>
                      <div class="text-xs text-green-600 mt-0.5">最近6天学习</div>
                    </div>
                  </div>
                </div>
                
                <!-- PT等级技能雷达图（简化版） -->
                <div class="mb-4">
                  <h4 class="text-xs font-medium text-neutral-700 mb-2">PT等级技能</h4>
                  <div class="space-y-1.5 text-xs">
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">听力</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-primary h-1.5 rounded-full" style="width: 62%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-10 text-right">62%</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">发音</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-orange-500 h-1.5 rounded-full" style="width: 50%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-10 text-right">50%</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">阅读</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-success h-1.5 rounded-full" style="width: 100%"></div>
                        </div>
                        <span class="text-success font-medium w-10 text-right">100%</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">词汇</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-primary h-1.5 rounded-full" style="width: 75%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-10 text-right">75%</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">语法</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-primary h-1.5 rounded-full" style="width: 71%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-10 text-right">71%</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">流利度</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-neutral-200 rounded-full h-1.5">
                          <div class="bg-neutral-300 h-1.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <span class="text-neutral-400 font-medium w-10 text-right">0%</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- 地道发音详情 -->
                <div class="bg-gradient-to-r from-purple-50 to-purple-100/50 rounded-lg p-3 border border-purple-200/50">
                  <div class="flex items-center justify-between mb-2">
                    <h4 class="text-xs font-medium text-neutral-700">地道发音</h4>
                    <div class="flex items-center gap-1 text-xs">
                      <span class="text-neutral-500">Lv3</span>
                      <i class="fa fa-arrow-right text-neutral-400 text-xs"></i>
                      <span class="text-neutral-500">Lv3</span>
                      <span class="text-neutral-400">(目标 Lv2)</span>
                    </div>
                  </div>
                  <div class="space-y-1.5 text-xs">
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">音准</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-white rounded-full h-1.5">
                          <div class="bg-purple-500 h-1.5 rounded-full" style="width: 85%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-16 text-right text-xs">85% (84%)</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">语调</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-white rounded-full h-1.5">
                          <div class="bg-purple-500 h-1.5 rounded-full" style="width: 91%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-16 text-right text-xs">91% (84%)</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">连续</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-white rounded-full h-1.5">
                          <div class="bg-danger h-1.5 rounded-full" style="width: 21%"></div>
                        </div>
                        <span class="text-danger font-medium w-16 text-right text-xs">21% (21%)</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">重音</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-white rounded-full h-1.5">
                          <div class="bg-purple-500 h-1.5 rounded-full" style="width: 86%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-16 text-right text-xs">86% (85%)</span>
                      </div>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-neutral-600">节奏</span>
                      <div class="flex items-center gap-2 flex-1 ml-2">
                        <div class="flex-1 bg-white rounded-full h-1.5">
                          <div class="bg-purple-500 h-1.5 rounded-full" style="width: 60%"></div>
                        </div>
                        <span class="text-neutral-700 font-medium w-16 text-right text-xs">60% (48%)</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              </div>
              
              <!-- AI助手TAB -->
              <div id="sidebar-ai-assistant-tab" class="sidebar-tab-content hidden">
                <!-- 1. 监察者部分（最上方） -->
                <div class="p-4 border-b border-neutral-200">
                  <h3 class="font-semibold text-neutral-800 mb-3 flex items-center">
                    <i class="fa fa-eye text-primary mr-2"></i> 监察者
                  </h3>
                  
                  <!-- AI带班状态 -->
                  <div class="mb-4" id="ai-supervisor-status">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm text-neutral-600">当前状态</span>
                      <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full font-medium">AI带班</span>
                  </div>
                  <div class="text-xs text-neutral-500">
                      AI正在自动处理客户沟通，如需转交人工可点击下方按钮
                  </div>
                </div>
                
                  <!-- 转交人工状态 -->
                  <div class="mb-4 hidden" id="handover-status">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm text-neutral-600">当前状态</span>
                      <span class="px-2 py-1 bg-warning/10 text-warning text-xs rounded-full font-medium">转交人工</span>
                    </div>
                    <div class="bg-warning/5 border border-warning/20 rounded-lg p-3 mt-2">
                      <div class="text-xs font-medium text-warning mb-1">转交原因：</div>
                      <div class="text-xs text-neutral-700" id="handover-reason">涉及价格谈判，AI无权限处理</div>
                    </div>
                  </div>
                  
                  <!-- 操作按钮 -->
                  <div class="flex gap-2">
                    <button id="switch-to-ai-btn" class="flex-1 text-xs bg-primary text-white px-3 py-2 rounded hover:bg-primary/90 transition-colors">
                      <i class="fa fa-robot mr-1"></i> 切换AI带班
                    </button>
                    <button id="handover-to-human-btn" class="flex-1 text-xs bg-warning text-white px-3 py-2 rounded hover:bg-warning/90 transition-colors">
                      <i class="fa fa-user mr-1"></i> 转交人工
                    </button>
                  </div>
                </div>
                
                <!-- 2. AI接待进度（挖需+督学流程可视化） -->
                <div class="p-4 border-b border-neutral-200">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="font-semibold text-neutral-800 flex items-center">
                    <i class="fa fa-sitemap text-primary mr-2"></i> AI接待进度
                  </h3>
                  <div class="flex gap-2">
                    <button class="px-4 py-1.5 bg-primary/10 text-primary rounded-lg active-task-mode font-medium text-sm" data-mode="needs">
                      挖需
                    </button>
                    <button class="px-4 py-1.5 text-neutral-500 rounded-lg hover:bg-neutral-100 font-medium text-sm" data-mode="supervision">
                      督学
                    </button>
                  </div>
                </div>
                
                <!-- 挖需流程 -->
                <div id="needs-flow" class="ai-task-flow">
                  <!-- 进度轴竖条 -->
                  <div class="progress-axis-line" id="needs-progress-axis"></div>
                  
                  <!-- DEGREE 0: 获取学习诉求 -->
                  <div class="degree-section" data-degree="0">
                    <div class="node-marker completed">0</div>
                    <div class="degree-header">
                      <span class="degree-badge">DEGREE 0</span>
                      <span class="degree-title">获取学习诉求</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-completed flex items-center gap-2">
                        <div class="node-icon bg-green-100 text-green-600">
                          <i class="fa fa-check-circle"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">用户诉求</div>
                          <div class="node-status">已完成</div>
                        </div>
                      </div>
                      <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                      </div>
                      <div class="flow-branches">
                        <div class="branch-node node-active flex items-center justify-between bg-neutral-50 border border-neutral-200 rounded p-2">
                          <div class="flex items-center gap-2">
                            <div class="node-icon bg-blue-100 text-blue-600">
                              <i class="fa fa-spinner fa-spin"></i>
                            </div>
                            <div class="node-title">工作需要</div>
                          </div>
                          <div class="node-status text-primary text-xs">运行中</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- DEGREE 1: 告知对应话术 -->
                  <div class="degree-section" data-degree="1">
                    <div class="node-marker active">1</div>
                    <div class="degree-header">
                      <span class="degree-badge">DEGREE 1</span>
                      <span class="degree-title">告知对应话术</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-active flex items-center gap-2">
                        <div class="node-icon bg-blue-100 text-blue-600">
                          <i class="fa fa-spinner fa-spin"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">工作需要话术</div>
                          <div class="node-status text-primary">运行中</div>
                        </div>
                      </div>
                      <!-- 操作按钮插入点 -->
                      <div class="dynamic-actions-placeholder" data-for-node="work-script"></div>
                    </div>
                  </div>
                  
                  <!-- DEGREE 2: 了解用户痛点（核心挖需） -->
                  <div class="degree-section" data-degree="2">
                    <div class="node-marker stuck">2</div>
                    <div class="degree-header">
                      <span class="degree-badge">DEGREE 2</span>
                      <span class="degree-title">了解用户痛点</span>
                    </div>
                    <div class="node-container">
                      <!-- 当前节点卡住 -->
                      <div class="flow-node node-stuck flex items-center gap-2" id="stuck-example-node" data-node-id="ask-scene">
                        <div class="node-icon bg-warning/20 text-warning">
                          <i class="fa fa-exclamation-triangle"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">问使用场景</div>
                          <div class="flex items-center gap-2 mt-1">
                            <span class="node-status text-warning">卡住</span>
                            <!-- 运行异常按钮（在当前节点停留） -->
                            <div class="flex gap-1.5">
                              <button class="action-continue text-xs bg-primary text-white px-2 py-0.5 rounded hover:bg-primary/90 transition-colors">
                                继续
                              </button>
                              <button class="action-wake text-xs bg-warning text-white px-2 py-0.5 rounded hover:bg-warning/90 transition-colors">
                                唤醒
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                      </div>
                      <div class="flow-node node-pending flex items-center gap-2">
                        <div class="node-icon bg-purple-100 text-purple-600">
                          <i class="fa fa-code-fork"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">是否有目标</div>
                          <div class="node-status text-neutral-500">待判断</div>
                        </div>
                      </div>
                      <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                      </div>
                      <div class="flow-branches">
                        <div class="branch-node node-pending flex items-center justify-between bg-neutral-50 border border-neutral-200 rounded p-2">
                          <div class="flex items-center gap-2">
                            <div class="node-icon bg-green-100 text-green-600">
                              <i class="fa fa-comments"></i>
                            </div>
                            <div class="node-title">报需话术</div>
                          </div>
                          <div class="node-badge text-xs text-neutral-500">有目标</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- DEGREE 3: 获取预期时间 -->
                  <div class="degree-section" data-degree="3">
                    <div class="node-marker pending">3</div>
                    <div class="degree-header">
                      <span class="degree-badge">DEGREE 3</span>
                      <span class="degree-title">获取预期时间</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-pending flex items-center gap-2">
                        <div class="node-icon bg-orange-100 text-orange-600">
                          <i class="fa fa-clock-o"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">制造紧迫性问预期</div>
                          <div class="node-status text-neutral-500">待执行</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- DEGREE 4: 告知开课时间 -->
                  <div class="degree-section" data-degree="4">
                    <div class="node-marker pending">4</div>
                    <div class="degree-header">
                      <span class="degree-badge">DEGREE 4</span>
                      <span class="degree-title">告知开课时间</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-pending flex items-center gap-2">
                        <div class="node-icon bg-purple-100 text-purple-600">
                          <i class="fa fa-calendar"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">判断开课时间</div>
                          <div class="node-status text-neutral-500">待执行</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- 督学流程（默认隐藏） -->
                <div id="supervision-flow" class="ai-task-flow hidden">
                  <!-- 进度轴竖条 -->
                  <div class="progress-axis-line" id="supervision-progress-axis"></div>
                  
                  <!-- 意图分类 -->
                  <div class="degree-section" data-degree="0">
                    <div class="node-marker completed">0</div>
                    <div class="degree-header">
                      <span class="degree-badge">意图分类</span>
                      <span class="degree-title">主流程判断</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-completed flex items-center gap-2">
                        <div class="node-icon bg-green-100 text-green-600">
                          <i class="fa fa-check-circle"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">意图分类完成</div>
                          <div class="node-status">主流程</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 任务执行判断 -->
                  <div class="degree-section" data-degree="1">
                    <div class="node-marker active">1</div>
                    <div class="degree-header">
                      <span class="degree-badge">任务判断</span>
                      <span class="degree-title">是否执行新任务</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-active flex items-center gap-2">
                        <div class="node-icon bg-purple-100 text-purple-600">
                          <i class="fa fa-spinner fa-spin"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">判断任务执行</div>
                          <div class="node-status text-primary">分析中</div>
                        </div>
                      </div>
                      <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                      </div>
                      <div class="flow-branches">
                        <div class="branch-node node-pending flex items-center justify-between bg-neutral-50 border border-neutral-200 rounded p-2">
                          <div class="flex items-center gap-2">
                            <div class="node-icon bg-green-100 text-green-600">
                              <i class="fa fa-code"></i>
                            </div>
                            <div class="node-title">执行任务</div>
                          </div>
                          <div class="node-status text-xs text-neutral-500">待执行</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 沟通计划 -->
                  <div class="degree-section">
                    <div class="degree-header">
                      <span class="degree-badge">督学任务</span>
                      <span class="degree-title">学习跟进</span>
                    </div>
                    <div class="node-container">
                      <div class="flow-node node-pending flex items-center gap-2">
                        <div class="node-icon bg-orange-100 text-orange-600">
                          <i class="fa fa-graduation-cap"></i>
                        </div>
                        <div class="node-content flex-1">
                          <div class="node-title">沟通计划</div>
                          <div class="node-status text-neutral-500">待执行</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- 节点卡住时的操作按钮（示例：当节点stuck时显示） -->
                <div id="stuck-node-actions" class="mt-3 p-3 bg-warning/10 border border-warning/30 rounded-lg hidden">
                  <div class="flex items-center gap-2 mb-2">
                    <i class="fa fa-exclamation-triangle text-warning"></i>
                    <span class="text-xs font-medium text-warning">节点运行异常</span>
                  </div>
                  <div class="flex flex-wrap gap-2">
                    <button class="text-xs bg-primary text-white px-3 py-1.5 rounded hover:bg-primary/90 transition-colors">
                      <i class="fa fa-bell mr-1"></i> 唤醒
                    </button>
                    <button class="text-xs bg-orange-500 text-white px-3 py-1.5 rounded hover:bg-orange-600 transition-colors">
                      <i class="fa fa-redo mr-1"></i> 二挖
                    </button>
                    <button class="text-xs bg-success text-white px-3 py-1.5 rounded hover:bg-success/90 transition-colors">
                      <i class="fa fa-play mr-1"></i> 按进度跟进任务
                    </button>
                  </div>
                </div>
                </div>
                
                <!-- AI开关设置 -->
                <div class="p-2 border-b border-neutral-200">
                  <h3 class="font-semibold text-neutral-800 mb-1.5 flex items-center text-sm">
                    <i class="fa fa-toggle-on text-primary mr-2"></i> AI开关设置
                  </h3>
                  
                  <!-- 1. 自动应答 -->
                  <div class="mb-2">
                    <h4 class="text-xs font-medium text-neutral-700 mb-1">自动应答</h4>
                    <div class="grid grid-cols-2 gap-x-3 gap-y-1">
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">进班接待</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="reception" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">挖需</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="discovery" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">督学</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="coaching" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">沉默唤醒</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="re-engage" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">等级测试提醒</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="level-test" class="sr-only switch-checkbox">
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">学习任务跟进</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="study-follow" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- 2. AI辅助 -->
                  <div class="mb-2">
                    <h4 class="text-xs font-medium text-neutral-700 mb-1">AI辅助</h4>
                    <div class="grid grid-cols-2 gap-x-3 gap-y-1">
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">对话提取</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="conversation-extract" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                      <div class="flex items-center justify-between">
                        <p class="text-xs font-medium">修改备注</p>
                        <label class="inline-flex items-center cursor-pointer ml-2">
                          <input type="checkbox" value="edit-note" class="sr-only switch-checkbox" checked>
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- 3. 监察者（带温度轴，1-10分） -->
                <div>
                    <h4 class="text-xs font-medium text-neutral-700 mb-1">监察者</h4>
                    <div class="space-y-1">
                      <div class="bg-neutral-50 border border-neutral-200 rounded p-1.5">
                        <div class="flex items-center gap-2">
                          <p class="text-xs font-medium flex-shrink-0">意向识别</p>
                          <input type="range" min="1" max="10" value="6" step="1" class="flex-1 ai-temp-supervisor" data-target="detect-intent">
                          <span class="w-5 text-right temp-value text-xs text-neutral-600">6</span>
                          <label class="inline-flex items-center cursor-pointer ml-1">
                            <input type="checkbox" value="detect-intent" class="sr-only switch-checkbox" checked>
                            <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                              <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                            </span>
                          </label>
                  </div>
                    </div>
                      <div class="bg-neutral-50 border border-neutral-200 rounded p-1.5">
                        <div class="flex items-center gap-2">
                          <p class="text-xs font-medium flex-shrink-0">价值识别</p>
                          <input type="range" min="1" max="10" value="5" step="1" class="flex-1 ai-temp-supervisor" data-target="detect-value">
                          <span class="w-5 text-right temp-value text-xs text-neutral-600">5</span>
                          <label class="inline-flex items-center cursor-pointer ml-1">
                            <input type="checkbox" value="detect-value" class="sr-only switch-checkbox" checked>
                            <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                              <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                            </span>
                          </label>
                    </div>
                    </div>
                      <div class="bg-neutral-50 border border-neutral-200 rounded p-1.5">
                        <div class="flex items-center gap-2">
                          <p class="text-xs font-medium flex-shrink-0">情绪识别</p>
                          <input type="range" min="1" max="10" value="5" step="1" class="flex-1 ai-temp-supervisor" data-target="detect-sentiment">
                          <span class="w-5 text-right temp-value text-xs text-neutral-600">5</span>
                          <label class="inline-flex items-center cursor-pointer ml-1">
                            <input type="checkbox" value="detect-sentiment" class="sr-only switch-checkbox" checked>
                            <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                              <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                            </span>
                          </label>
                        </div>
                      </div>
                      <div class="bg-neutral-50 border border-neutral-200 rounded p-1.5">
                        <div class="flex items-center gap-2">
                          <p class="text-xs font-medium flex-shrink-0">答不上</p>
                          <input type="range" min="1" max="10" value="4" step="1" class="flex-1 ai-temp-supervisor" data-target="detect-badcase">
                          <span class="w-5 text-right temp-value text-xs text-neutral-600">4</span>
                          <label class="inline-flex items-center cursor-pointer ml-1">
                            <input type="checkbox" value="detect-badcase" class="sr-only switch-checkbox">
                            <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                              <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                            </span>
                          </label>
                        </div>
                      </div>
                  </div>
                </div>
              </div>
              
                <!-- 3. AI客户分析 -->
              <div class="p-4 border-b border-neutral-200">
                <h3 class="font-semibold text-neutral-800 mb-3 flex items-center">
                  <i class="fa fa-robot text-primary mr-2"></i> AI客户分析
                </h3>
                
                <div class="text-sm text-neutral-700 space-y-2">
                  <p>该客户为大三学生，对Python进阶课程有明确兴趣，关注课程内容与学生优惠（价格敏感但消费能力中等偏上）。</p>
                  <p>近7天APP活跃度高，已学习3节基础课，学习进度正常，可推荐进阶路径相关内容。</p>
                  <p class="text-primary">建议策略：发送进阶班大纲+学生专享优惠，同步邀请参加本周五的直播答疑。</p>
                </div>
                
                <button class="mt-3 w-full text-xs bg-primary/10 text-primary py-1.5 rounded hover:bg-primary/20 transition-colors">
                  生成跟进计划
                </button>
              </div>
                </div>
                  </div>
                  </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 客户管理后台（核心界面2，支持交互） -->
  <section id="backend" class="py-16 bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-center mb-4 text-neutral-800">客户管理后台</h2>
      <p class="text-center text-neutral-600 mb-12 max-w-3xl mx-auto">
        群体分层管理+任务中心+AI配置，支持完整交互操作
      </p>
      
      <!-- 界面原型（支持交互） -->
      <div class="max-w-6xl mx-auto mb-16">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-neutral-200">
          <!-- 顶部导航（任务中心作为首个TAB） -->
          <div class="bg-neutral-50 border-b border-neutral-200">
            <div class="flex overflow-x-auto scrollbar-hide" id="backend-tabs">
              <button class="px-6 py-4 border-b-2 tab-active whitespace-nowrap" data-tab="task-center">
                任务中心
              </button>
              <button class="px-6 py-4 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 whitespace-nowrap" data-tab="group-portrait">
                我的班级
              </button>
              <button class="px-6 py-4 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 whitespace-nowrap" data-tab="ai-config">
                AI配置
              </button>
              <button class="px-6 py-4 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 whitespace-nowrap" data-tab="knowledge-base">
                知识库
              </button>
              <button class="px-6 py-4 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 whitespace-nowrap" data-tab="workflow-engine">
                流程引擎
              </button>
            </div>
          </div>
          
          <!-- 1. 任务中心（默认显示） -->
          <div class="p-6" id="task-center-tab">
            <h3 class="text-lg font-semibold mb-6">任务中心</h3>
            
            <!-- 切换标签 -->
            <div class="flex border-b border-neutral-200 mb-6" id="task-subtabs">
              <button class="px-4 py-2 text-primary border-b-2 border-primary font-medium text-sm" data-subtab="customer-follow">
                客户跟进（8）
              </button>
              <button class="px-4 py-2 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 text-sm" data-subtab="operation-task">
                运营任务（5）
              </button>
            </div>
            
            <!-- 1.1 客户跟进（AI转接的待跟进清单） -->
            <div id="customer-follow-tab">
              <div class="bg-neutral-50 p-4 rounded-lg mb-4">
                <div class="flex justify-between items-center mb-4">
                  <h4 class="font-medium">AI转接待跟进客户</h4>
                  <div class="flex gap-2">
                    <button class="text-xs bg-neutral-200 text-neutral-700 px-3 py-1 rounded hover:bg-neutral-300">
                      全部
                    </button>
                    <button class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary/90">
                      高优先级
                    </button>
                  </div>
                </div>
                
                <!-- 客户列表 -->
                <div class="space-y-3 max-h-96 overflow-y-auto pr-2">
                  <!-- 客户1 -->
                  <div class="bg-white p-3 rounded border border-neutral-200 card-hover">
                    <div class="flex justify-between items-start">
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs">
                          <i class="fa fa-user"></i>
                        </div>
                        <div class="ml-3">
                          <div class="flex items-center gap-2">
                            <p class="font-medium text-sm">李同学</p>
                            <span class="text-xs text-neutral-400">379516893</span>
                          </div>
                          <p class="text-xs text-neutral-500 mt-0.5">询问Python就业班学费及就业保障</p>
                          <div class="flex flex-wrap gap-1 mt-1.5">
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">上班族</span>
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">工作需要</span>
                          </div>
                        </div>
                      </div>
                      <span class="px-2 py-0.5 bg-danger/10 text-danger text-xs rounded-full">
                        高优先级
                      </span>
                    </div>
                    <div class="mt-3 flex justify-between items-center">
                      <span class="text-xs text-neutral-500">转接原因：涉及价格谈判（AI无权限）</span>
                      <div class="flex gap-2">
                        <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">
                          立即跟进
                        </button>
                        <button class="text-xs bg-primary/10 text-primary px-3 py-1 rounded hover:bg-primary/20">
                          分配AI
                        </button>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 客户2 -->
                  <div class="bg-white p-3 rounded border border-neutral-200 card-hover">
                    <div class="flex justify-between items-start">
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs">
                          <i class="fa fa-user"></i>
                        </div>
                        <div class="ml-3">
                          <div class="flex items-center gap-2">
                            <p class="font-medium text-sm">王同学</p>
                            <span class="text-xs text-neutral-400">382145678</span>
                          </div>
                          <p class="text-xs text-neutral-500 mt-0.5">投诉课程更新不及时</p>
                          <div class="flex flex-wrap gap-1 mt-1.5">
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">学生</span>
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">自我提升</span>
                          </div>
                        </div>
                      </div>
                      <span class="px-2 py-0.5 bg-danger/10 text-danger text-xs rounded-full">
                        高优先级
                      </span>
                    </div>
                    <div class="mt-3 flex justify-between items-center">
                      <span class="text-xs text-neutral-500">转接原因：客户情绪激动（需人工安抚）</span>
                      <div class="flex gap-2">
                        <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">
                          立即跟进
                        </button>
                        <button class="text-xs bg-neutral-200 text-neutral-700 px-3 py-1 rounded cursor-not-allowed" title="该类型任务需人工处理">
                          分配AI
                        </button>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 客户3 -->
                  <div class="bg-white p-3 rounded border border-neutral-200 card-hover">
                    <div class="flex justify-between items-start">
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs">
                          <i class="fa fa-user"></i>
                        </div>
                        <div class="ml-3">
                          <div class="flex items-center gap-2">
                            <p class="font-medium text-sm">赵同学</p>
                            <span class="text-xs text-neutral-400">385912347</span>
                          </div>
                          <p class="text-xs text-neutral-500 mt-0.5">想了解数据分析课程的学习路径</p>
                          <div class="flex flex-wrap gap-1 mt-1.5">
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">上班族</span>
                            <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">职业发展</span>
                          </div>
                        </div>
                      </div>
                      <span class="px-2 py-0.5 bg-warning/10 text-warning text-xs rounded-full">
                        中优先级
                      </span>
                    </div>
                    <div class="mt-3 flex justify-between items-center">
                      <span class="text-xs text-neutral-500">转接原因：路径规划需个性化建议</span>
                      <div class="flex gap-2">
                        <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">
                          立即跟进
                        </button>
                        <button class="text-xs bg-primary/10 text-primary px-3 py-1 rounded hover:bg-primary/20">
                          分配AI
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 1.2 运营任务 -->
            <div id="operation-task-tab" class="hidden">
              <div class="bg-neutral-50 p-4 rounded-lg">
                <h4 class="font-medium mb-4">今日运营目标</h4>
                
                <!-- 目标进度 -->
                <div class="space-y-4 mb-6">
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-neutral-600">转化目标（进阶班）</span>
                      <span>3/5 单</span>
                    </div>
                    <div class="w-full bg-neutral-200 rounded-full h-2">
                      <div class="bg-success h-2 rounded-full" style="width: 60%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-neutral-600">客户沟通目标</span>
                      <span>12/20 人</span>
                    </div>
                    <div class="w-full bg-neutral-200 rounded-full h-2">
                      <div class="bg-primary h-2 rounded-full" style="width: 60%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-neutral-600">学习跟进目标</span>
                      <span>8/15 人</span>
                    </div>
                    <div class="w-full bg-neutral-200 rounded-full h-2">
                      <div class="bg-warning h-2 rounded-full" style="width: 53%"></div>
                    </div>
                  </div>
                </div>
                
                <h4 class="font-medium mb-4">待完成运营任务</h4>
                
                <!-- 任务列表 -->
                <div class="space-y-3 max-h-64 overflow-y-auto pr-2">
                  <!-- 任务1 -->
                  <div class="bg-white p-3 rounded border border-neutral-200 card-hover">
                    <div class="flex justify-between items-start">
                      <p class="font-medium text-sm">带班周期提醒：Python基础班（第3周）</p>
                      <span class="text-xs text-neutral-500">14:00前</span>
                    </div>
                    <p class="text-xs text-neutral-600 mt-1">需发布本周学习重点及作业提醒</p>
                    <div class="mt-2 flex justify-end gap-2">
                      <button class="text-xs bg-primary/10 text-primary px-3 py-1 rounded hover:bg-primary/20">
                        分配AI执行
                      </button>
                      <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">
                        手动完成
                      </button>
                    </div>
                  </div>
                  
                  <!-- 任务2 -->
                  <div class="bg-white p-3 rounded border border-neutral-200 card-hover">
                    <div class="flex justify-between items-start">
                      <p class="font-medium text-sm">高意向客户二次触达</p>
                      <span class="text-xs text-neutral-500">16:30前</span>
                    </div>
                    <p class="text-xs text-neutral-600 mt-1">对5名上周咨询未成交客户发送优惠提醒</p>
                    <div class="mt-2 flex justify-end gap-2">
                      <button class="text-xs bg-primary/10 text-primary px-3 py-1 rounded hover:bg-primary/20">
                        分配AI执行
                      </button>
                      <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">
                        手动完成
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 2. 我的班级 -->
          <div class="p-6 hidden" id="group-portrait-tab">
            <!-- 红框区域：班级信息 -->
            <div class="bg-white border border-neutral-200 rounded-lg p-4 mb-4">
              <div class="flex items-center gap-6 flex-wrap">
                <div class="flex items-center gap-2">
                  <span class="text-sm text-neutral-600">社群名称：</span>
                  <div class="flex flex-wrap gap-2 items-center">
                    <div id="community-selector" class="relative">
                      <div class="flex flex-wrap gap-2 items-center min-w-[200px] border border-neutral-300 rounded px-2 py-1 cursor-pointer hover:border-primary community-selector-display">
                        <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full font-medium flex items-center gap-1">
                          Python进阶班2024
                          <button class="text-primary hover:text-primary/80" onclick="event.stopPropagation(); removeCommunity('Python进阶班2024');">
                            <i class="fa fa-times text-xs"></i>
                          </button>
                        </span>
                        <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full font-medium flex items-center gap-1">
                          Java基础班2024
                          <button class="text-primary hover:text-primary/80" onclick="event.stopPropagation(); removeCommunity('Java基础班2024');">
                            <i class="fa fa-times text-xs"></i>
                          </button>
                        </span>
                        <span class="px-2 py-1 bg-primary/10 text-primary text-xs rounded-full font-medium flex items-center gap-1">
                          数据分析班2024
                          <button class="text-primary hover:text-primary/80" onclick="event.stopPropagation(); removeCommunity('数据分析班2024');">
                            <i class="fa fa-times text-xs"></i>
                          </button>
                        </span>
                        <span class="text-xs text-neutral-400">+ 选择</span>
                      </div>
                      <div id="community-dropdown" class="hidden absolute top-full left-0 mt-1 bg-white border border-neutral-300 rounded-lg shadow-lg z-10 p-2 min-w-[200px]">
                        <div class="space-y-1 max-h-48 overflow-y-auto">
                          <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
                            <input type="checkbox" value="Python进阶班2024" class="community-checkbox" checked>
                            <span class="text-xs">Python进阶班2024</span>
                          </label>
                          <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
                            <input type="checkbox" value="Java基础班2024" class="community-checkbox" checked>
                            <span class="text-xs">Java基础班2024</span>
                          </label>
                          <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
                            <input type="checkbox" value="数据分析班2024" class="community-checkbox" checked>
                            <span class="text-xs">数据分析班2024</span>
                          </label>
                          <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
                            <input type="checkbox" value="前端开发班2024" class="community-checkbox">
                            <span class="text-xs">前端开发班2024</span>
                          </label>
                          <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
                            <input type="checkbox" value="UI设计班2024" class="community-checkbox">
                            <span class="text-xs">UI设计班2024</span>
                          </label>
                        </div>
                      </div>
                    </div>
                    <span class="text-xs text-neutral-500">排班总人数：<span class="font-medium text-neutral-700">156</span></span>
                    <span class="text-xs text-neutral-500">群内总人数：<span class="font-medium text-neutral-700">142</span></span>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-sm text-neutral-600">开班时间：</span>
                  <span class="text-sm font-medium">2024-01-15</span>
                  <button class="text-xs text-primary hover:text-primary/80 ml-1" id="edit-class-time-btn">
                    <i class="fa fa-pencil"></i> 修改
                  </button>
                </div>
              </div>
            </div>
            
            <!-- 筛选框 -->
            <div class="bg-neutral-50 p-4 rounded-lg mb-4">
              <!-- 标签筛选 -->
              <div class="mb-3">
                <label class="text-xs text-neutral-600 block mb-2">标签筛选</label>
                <div class="flex flex-wrap gap-2">
                  <button class="px-3 py-1 bg-success/10 text-success text-xs rounded-full border border-success/20 hover:bg-success/20 filter-tag-btn active-tag" data-tag="high-value">
                    高价值
                  </button>
                  <button class="px-3 py-1 bg-danger/10 text-danger text-xs rounded-full border border-danger/20 hover:bg-danger/20 filter-tag-btn active-tag" data-tag="high-intent">
                    高意向
                  </button>
                  <button class="px-3 py-1 bg-warning/10 text-warning text-xs rounded-full border border-warning/20 hover:bg-warning/20 filter-tag-btn" data-tag="medium-value">
                    中价值
                  </button>
                  <button class="px-3 py-1 bg-warning/10 text-warning text-xs rounded-full border border-warning/20 hover:bg-warning/20 filter-tag-btn" data-tag="medium-intent">
                    中意向
                  </button>
                  <button class="px-3 py-1 bg-primary/10 text-primary text-xs rounded-full border border-primary/20 hover:bg-primary/20 filter-tag-btn" data-tag="low-value">
                    低价值
                  </button>
                  <button class="px-3 py-1 bg-primary/10 text-primary text-xs rounded-full border border-primary/20 hover:bg-primary/20 filter-tag-btn" data-tag="low-intent">
                    低意向
                  </button>
                </div>
              </div>
              
              <!-- 其他筛选条件 -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div>
                  <label class="text-xs text-neutral-600 block mb-1">意向分数</label>
                  <div class="flex items-center gap-2">
                    <input type="number" placeholder="最低" min="0" max="100" class="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary filter-score-min" data-filter="score-min">
                    <span class="text-xs text-neutral-500">-</span>
                    <input type="number" placeholder="最高" min="0" max="100" class="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary filter-score-max" data-filter="score-max">
                  </div>
                </div>
                <div>
                  <label class="text-xs text-neutral-600 block mb-1">AI接待与否</label>
                  <select class="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary filter-select" data-filter="ai-auto">
                    <option value="">全部</option>
                    <option value="yes">已开启</option>
                    <option value="no">未开启</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs text-neutral-600 block mb-1">学习目标</label>
                  <select class="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary filter-select" data-filter="goal">
                    <option value="">全部</option>
                    <option value="career">职业发展</option>
                    <option value="abroad">出国游</option>
                    <option value="exam">雅思考试</option>
                  </select>
                </div>
                <div>
                  <label class="text-xs text-neutral-600 block mb-1">职业</label>
                  <select class="w-full text-xs border border-neutral-300 rounded px-2 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary filter-select" data-filter="occupation">
                    <option value="">全部</option>
                    <option value="student">学生</option>
                    <option value="office">上班族</option>
                    <option value="internet">互联网</option>
                    <option value="finance">金融</option>
                    <option value="education">教育</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- 客户列表 -->
            <div>
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-medium">学员列表</h4>
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-neutral-500">一键开启AI接待</span>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="global-ai-switch" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-primary rounded-full transition-colors switch-label">
                        <span class="absolute right-0.5 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center gap-3">
                    <button class="text-xs bg-primary text-white px-4 py-1.5 rounded hover:bg-primary/90 flex items-center gap-1">
                      <i class="fa fa-paper-plane"></i>
                      群发
                    </button>
                    <span class="text-xs text-neutral-500">按照对应群体创建群发任务</span>
                  </div>
                </div>
              </div>
              
              <!-- 2.1 意向维度分层卡片（可点击，已隐藏） -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8" style="display: none;">
              <!-- 高意向 -->
              <div class="bg-white border border-danger/20 rounded-lg p-4 shadow-sm card-hover cursor-pointer" id="high-intent-card">
                <div class="flex justify-between items-start mb-3">
                  <h4 class="font-medium">高意向客户</h4>
                  <span class="w-3 h-3 rounded-full bg-danger"></span>
                </div>
                <div class="text-3xl font-bold mb-1">42</div>
                <div class="text-sm text-neutral-500 mb-3">客户数量</div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-neutral-600">3日转化率</span>
                    <span class="font-medium">28%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-neutral-600">AI覆盖率</span>
                    <span class="font-medium">35%</span>
                  </div>
                </div>
                <button class="w-full mt-4 text-sm bg-danger/10 text-danger py-1.5 rounded hover:bg-danger/20 transition-colors">
                  查看客户列表 →
                </button>
              </div>
              
              <!-- 中意向 -->
              <div class="bg-white border border-warning/20 rounded-lg p-4 shadow-sm card-hover cursor-pointer">
                <div class="flex justify-between items-start mb-3">
                  <h4 class="font-medium">中意向客户</h4>
                  <span class="w-3 h-3 rounded-full bg-warning"></span>
                </div>
                <div class="text-3xl font-bold mb-1">89</div>
                <div class="text-sm text-neutral-500 mb-3">客户数量</div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-neutral-600">3日转化率</span>
                    <span class="font-medium">12%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-neutral-600">AI覆盖率</span>
                    <span class="font-medium">78%</span>
                  </div>
                </div>
                <button class="w-full mt-4 text-sm bg-warning/10 text-warning py-1.5 rounded hover:bg-warning/20 transition-colors">
                  查看客户列表 →
                </button>
              </div>
              
              <!-- 低意向 -->
              <div class="bg-white border border-primary/20 rounded-lg p-4 shadow-sm card-hover cursor-pointer">
                <div class="flex justify-between items-start mb-3">
                  <h4 class="font-medium">低意向客户</h4>
                  <span class="w-3 h-3 rounded-full bg-primary"></span>
                </div>
                <div class="text-3xl font-bold mb-1">156</div>
                <div class="text-sm text-neutral-500 mb-3">客户数量</div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-neutral-600">3日转化率</span>
                    <span class="font-medium">3%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-neutral-600">AI覆盖率</span>
                    <span class="font-medium">92%</span>
                  </div>
                </div>
                <button class="w-full mt-4 text-sm bg-primary/10 text-primary py-1.5 rounded hover:bg-primary/20 transition-colors">
                  查看客户列表 →
                </button>
              </div>
              
              <!-- 新客户 -->
              <div class="bg-white border border-success/20 rounded-lg p-4 shadow-sm card-hover cursor-pointer">
                <div class="flex justify-between items-start mb-3">
                  <h4 class="font-medium">新客户</h4>
                  <span class="w-3 h-3 rounded-full bg-success"></span>
                </div>
                <div class="text-3xl font-bold mb-1">63</div>
                <div class="text-sm text-neutral-500 mb-3">客户数量</div>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-neutral-600">3日转化率</span>
                    <span class="font-medium">18%</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-neutral-600">AI覆盖率</span>
                    <span class="font-medium">85%</span>
                  </div>
                </div>
                <button class="w-full mt-4 text-sm bg-success/10 text-success py-1.5 rounded hover:bg-success/20 transition-colors">
                  查看客户列表 →
                </button>
              </div>
            </div>
            
                
                <!-- 表格 -->
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-neutral-200">
                    <thead>
                      <tr>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">客户名称</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">备注</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">昵称</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">流利号</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">职业</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">意向分数</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">AI标签</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">学习目标</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">AI接待</th>
                        <th class="px-3 py-3 bg-neutral-50 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">好友时间</th>
                        <th class="px-3 py-3 bg-neutral-50 text-right text-xs font-medium text-neutral-500 uppercase tracking-wider">操作</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-neutral-200" id="class-student-list">
                    <tr class="hover:bg-neutral-50" data-score="85" data-ai-auto="yes" data-goal="abroad" data-occupation="student" data-high-value="true" data-high-intent="true">
                      <td class="px-3 py-3 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs mr-2">
                            <i class="fa fa-user"></i>
                          </div>
                          <span class="text-sm">张同学</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">重点客户</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">小张</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">379516893</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">学生</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-sm font-medium">85分</span>
                      </td>
                      <td class="px-3 py-3">
                        <div class="flex flex-wrap gap-1">
                          <span class="px-1.5 py-0.5 bg-success/10 text-success text-xs rounded">高价值</span>
                          <span class="px-1.5 py-0.5 bg-danger/10 text-danger text-xs rounded">高意向</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">学生</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">工作需要</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">互联网</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded-full">出国游</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <label class="inline-flex items-center cursor-pointer">
                          <input type="checkbox" class="sr-only row-ai-switch" checked>
                          <span class="relative inline-block w-10 h-5 bg-primary rounded-full transition-colors switch-label">
                            <span class="absolute right-0.5 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">2024-01-10</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap text-right text-sm">
                        <button class="text-primary hover:text-primary/80 mr-3">去对话</button>
                        <button class="text-neutral-600 hover:text-neutral-900">详情</button>
                      </td>
                    </tr>
                    <tr class="hover:bg-neutral-50" data-score="82" data-ai-auto="yes" data-goal="career" data-occupation="office" data-medium-value="true" data-medium-intent="true">
                      <td class="px-3 py-3 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs mr-2">
                            <i class="fa fa-user"></i>
                          </div>
                          <span class="text-sm">李同学</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">跟进中</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">小李</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">382145678</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">上班族</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-sm font-medium">82分</span>
                      </td>
                      <td class="px-3 py-3">
                        <div class="flex flex-wrap gap-1">
                          <span class="px-1.5 py-0.5 bg-warning/10 text-warning text-xs rounded">中价值</span>
                          <span class="px-1.5 py-0.5 bg-warning/10 text-warning text-xs rounded">中意向</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">上班族</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">自我提升</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">金融</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded-full">职业发展</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <label class="inline-flex items-center cursor-pointer">
                          <input type="checkbox" class="sr-only row-ai-switch" checked>
                          <span class="relative inline-block w-10 h-5 bg-primary rounded-full transition-colors switch-label">
                            <span class="absolute right-0.5 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">2024-01-08</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap text-right text-sm">
                        <button class="text-primary hover:text-primary/80 mr-3">去对话</button>
                        <button class="text-neutral-600 hover:text-neutral-900">详情</button>
                      </td>
                    </tr>
                    <tr class="hover:bg-neutral-50" data-score="79" data-ai-auto="no" data-goal="exam" data-occupation="student" data-high-value="true" data-high-intent="true">
                      <td class="px-3 py-3 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xs mr-2">
                            <i class="fa fa-user"></i>
                          </div>
                          <span class="text-sm">王同学</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">-</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">小王</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">385912347</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-700">学生</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-sm font-medium">79分</span>
                      </td>
                      <td class="px-3 py-3">
                        <div class="flex flex-wrap gap-1">
                          <span class="px-1.5 py-0.5 bg-success/10 text-success text-xs rounded">高价值</span>
                          <span class="px-1.5 py-0.5 bg-danger/10 text-danger text-xs rounded">高意向</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">学生</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">出国留学</span>
                          <span class="px-1.5 py-0.5 bg-blue-50 text-blue-700 text-xs rounded">教育</span>
                        </div>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded-full">雅思考试</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <label class="inline-flex items-center cursor-pointer">
                          <input type="checkbox" class="sr-only row-ai-switch">
                          <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                            <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                          </span>
                        </label>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap">
                        <span class="text-xs text-neutral-500">2024-01-05</span>
                      </td>
                      <td class="px-3 py-3 whitespace-nowrap text-right text-sm">
                        <button class="text-primary hover:text-primary/80 mr-3">去对话</button>
                        <button class="text-neutral-600 hover:text-neutral-900">详情</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- 分页 -->
              <div class="flex justify-between items-center mt-4 text-sm">
                <div class="text-neutral-500">显示 1-3 条，共 42 条</div>
                <div class="flex gap-1">
                  <button class="w-8 h-8 flex items-center justify-center rounded border border-neutral-300 text-neutral-500 hover:border-primary hover:text-primary">
                    <i class="fa fa-chevron-left text-xs"></i>
                  </button>
                  <button class="w-8 h-8 flex items-center justify-center rounded bg-primary text-white">1</button>
                  <button class="w-8 h-8 flex items-center justify-center rounded border border-neutral-300 hover:border-primary hover:text-primary">2</button>
                  <button class="w-8 h-8 flex items-center justify-center rounded border border-neutral-300 hover:border-primary hover:text-primary">3</button>
                  <button class="w-8 h-8 flex items-center justify-center rounded border border-neutral-300 text-neutral-500 hover:border-primary hover:text-primary">
                    <i class="fa fa-chevron-right text-xs"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 3. AI配置（合并多个模块） -->
          <div class="p-6 hidden" id="ai-config-tab">
            <h3 class="text-lg font-semibold mb-6">AI配置中心</h3>
            
            <!-- AI配置子标签 -->
            <div class="flex border-b border-neutral-200 mb-6" id="ai-config-subtabs">
              <button class="px-4 py-2 text-primary border-b-2 border-primary font-medium text-sm" data-subtab="ai-switches">
                AI开关设置
              </button>
              <button class="px-4 py-2 text-neutral-600 border-b-2 border-transparent hover:text-neutral-900 text-sm" data-subtab="style-adjust">
                风格调整
              </button>
            </div>
            
            <!-- 3.1 AI开关设置 -->
            <div id="ai-switches-tab">
              <!-- 1. 自动应答 -->
              <div class="bg-neutral-50 p-3 rounded-lg mb-4">
                <h4 class="font-medium mb-3 text-sm">自动应答</h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">进班接待</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="reception" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">挖需</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="discovery" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">督学</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="coaching" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">沉默唤醒</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="re-engage" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">等级测试提醒</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="level-test" class="sr-only switch-checkbox">
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">学习任务跟进</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="study-follow" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- 2. AI辅助 -->
              <div class="bg-neutral-50 p-3 rounded-lg mb-4">
                <h4 class="font-medium mb-3 text-sm">AI辅助</h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">对话提取</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="conversation-extract" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <p class="text-xs font-medium">修改备注</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="edit-note" class="sr-only switch-checkbox" checked>
                      <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- 3. 监察者（带温度轴，1-10分） -->
              <div class="bg-neutral-50 p-3 rounded-lg mb-4">
                <h4 class="font-medium mb-3 text-sm">监察者</h4>
                <div class="grid grid-cols-2 gap-2">
                  <div class="bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <div class="flex items-center justify-between mb-1.5">
                      <p class="text-xs font-medium">意向识别</p>
                      <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="detect-intent" class="sr-only switch-checkbox" checked>
                        <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                          <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                        </span>
                      </label>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-neutral-600">
                      <input type="range" min="1" max="10" value="6" step="1" class="flex-1 h-1 ai-temp-supervisor" data-target="detect-intent">
                      <span class="w-6 text-right temp-value text-xs">6</span>
                    </div>
                  </div>
                  <div class="bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <div class="flex items-center justify-between mb-1.5">
                      <p class="text-xs font-medium">价值识别</p>
                      <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="detect-value" class="sr-only switch-checkbox" checked>
                        <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                          <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                        </span>
                      </label>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-neutral-600">
                      <input type="range" min="1" max="10" value="5" step="1" class="flex-1 h-1 ai-temp-supervisor" data-target="detect-value">
                      <span class="w-6 text-right temp-value text-xs">5</span>
                    </div>
                  </div>
                  <div class="bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <div class="flex items-center justify-between mb-1.5">
                      <p class="text-xs font-medium">情绪识别</p>
                      <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="detect-sentiment" class="sr-only switch-checkbox" checked>
                        <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                          <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                        </span>
                      </label>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-neutral-600">
                      <input type="range" min="1" max="10" value="5" step="1" class="flex-1 h-1 ai-temp-supervisor" data-target="detect-sentiment">
                      <span class="w-6 text-right temp-value text-xs">5</span>
                    </div>
                  </div>
                  <div class="bg-white border border-neutral-200 rounded px-2 py-1.5">
                    <div class="flex items-center justify-between mb-1.5">
                      <p class="text-xs font-medium">答不上</p>
                      <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" value="detect-badcase" class="sr-only switch-checkbox">
                        <span class="relative inline-block w-10 h-5 bg-neutral-300 rounded-full transition-colors switch-label">
                          <span class="absolute left-0 top-0.5 w-4 h-4 bg-white rounded-full border border-neutral-300 transition-all"></span>
                        </span>
                      </label>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-neutral-600">
                      <input type="range" min="1" max="10" value="4" step="1" class="flex-1 h-1 ai-temp-supervisor" data-target="detect-badcase">
                      <span class="w-6 text-right temp-value text-xs">4</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 3.2 风格调整 -->
            <div id="style-adjust-tab" class="hidden">
              <div class="grid md:grid-cols-2 gap-6">
                <!-- 聊天记录上传 + 开关 -->
                <div class="bg-neutral-50 p-4 rounded-lg">
                  <h4 class="font-medium mb-3">聊天记录上传</h4>
                  <div class="flex items-center justify-between mb-3">
                    <p class="text-sm">允许AI识别用户消息并模仿个人风格</p>
                    <label class="inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="chat-style-on" class="sr-only switch-checkbox">
                      <span class="relative inline-block w-12 h-6 bg-neutral-300 rounded-full transition-colors switch-label">
                        <span class="absolute left-0 top-0.5 w-5 h-5 bg-white rounded-full border border-neutral-300 transition-all"></span>
                      </span>
                    </label>
                  </div>
                  <div class="border border-dashed border-neutral-300 rounded-lg p-4 text-center">
                    <i class="fa fa-file-text-o text-neutral-500 mb-2"></i>
                    <p class="text-sm mb-2">支持 txt / md / csv</p>
                    <button class="text-xs bg-neutral-800 text-white px-3 py-1 rounded hover:bg-neutral-700">上传聊天记录</button>
                  </div>
                </div>
              </div>

              <!-- 基础风格选择 -->
              <div class="bg-neutral-50 p-4 rounded-lg mt-6">
                <h4 class="font-medium mb-3">基础风格选择</h4>
                <div class="grid sm:grid-cols-3 gap-3 text-sm">
                  <label class="flex items-center gap-2 p-3 border border-neutral-200 rounded-lg cursor-pointer hover:bg-white">
                    <input type="radio" name="base-style" class="accent-primary" checked>
                    <span>专业严谨</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 border border-neutral-200 rounded-lg cursor-pointer hover:bg-white">
                    <input type="radio" name="base-style" class="accent-primary">
                    <span>亲切耐心</span>
                  </label>
                  <label class="flex items-center gap-2 p-3 border border-neutral-200 rounded-lg cursor-pointer hover:bg-white">
                    <input type="radio" name="base-style" class="accent-primary">
                    <span>高效简洁</span>
                  </label>
                </div>
              </div>
            </div>

          </div>
          
          <!-- 4. 知识库 -->
          <div class="p-6 hidden" id="knowledge-base-tab">
            <div class="mb-6">
              <!-- 标题 -->
              <h3 class="text-2xl font-bold text-neutral-900 mb-6">知识库列表</h3>
              
              <!-- 搜索和操作栏 -->
              <div class="flex items-center justify-between mb-6">
                <!-- 搜索框 -->
                <div class="flex items-center gap-2 flex-1 max-w-md">
                  <div class="relative flex-1">
                    <input type="text" placeholder="输入文件名称,按回车键搜索" class="w-full border border-neutral-300 rounded-lg px-4 py-2 pl-10 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                    <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"></i>
                  </div>
                  <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                    搜索
                  </button>
                </div>
                
                <!-- 操作按钮 -->
                <div class="flex items-center gap-3">
                  <button class="border border-primary text-primary px-4 py-2 rounded-lg hover:bg-primary/5 transition-colors font-medium">
                    自定义文件
                  </button>
                  <button class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors font-medium">
                    上传文件
                  </button>
                </div>
              </div>
            </div>
            
            <!-- 文件卡片网格 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <!-- XLS文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-excel-o text-green-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">自定义文件.xls</div>
                    <div class="text-xs text-neutral-500">2023-03-12 20:02 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-excel-o text-green-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">组合素材.xls</div>
                    <div class="text-xs text-neutral-500">2023-03-11 15:30 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-excel-o text-green-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">有赞打通.xls</div>
                    <div class="text-xs text-neutral-500">2023-03-10 09:15 上传</div>
                  </div>
                </div>
              </div>
              
              <!-- PDF文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-pdf-o text-red-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">群发知识库.PDF</div>
                    <div class="text-xs text-neutral-500">2023-03-09 18:45 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-pdf-o text-red-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">客户管理.PDF</div>
                    <div class="text-xs text-neutral-500">2023-03-08 14:20 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-pdf-o text-red-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">客户流失.PDF</div>
                    <div class="text-xs text-neutral-500">2023-03-07 11:30 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-pdf-o text-red-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">操作手册.PDF</div>
                    <div class="text-xs text-neutral-500">2023-03-06 16:10 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-pdf-o text-red-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">专属知识库.PDF</div>
                    <div class="text-xs text-neutral-500">2023-03-05 10:25 上传</div>
                  </div>
                </div>
              </div>
              
              <!-- JPG文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-image-o text-purple-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">抽奖活动.jpg</div>
                    <div class="text-xs text-neutral-500">2023-03-04 13:40 上传</div>
                  </div>
                </div>
                <div class="absolute bottom-2 right-2">
                  <span class="px-2 py-1 bg-orange-500 text-white text-xs rounded">文件处理中...</span>
                </div>
              </div>
              
              <!-- MP4文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-video-o text-blue-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">产品介绍视频.mp4</div>
                    <div class="text-xs text-neutral-500">2023-03-03 08:50 上传</div>
                  </div>
                </div>
              </div>
              
              <!-- HTML文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-code-o text-blue-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">网页数据源</div>
                    <div class="text-xs text-neutral-500">2023-03-02 17:15 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-code-o text-blue-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">表单内容</div>
                    <div class="text-xs text-neutral-500">2023-03-01 12:00 上传</div>
                  </div>
                </div>
              </div>
              
              <!-- DOC文件卡片 -->
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-word-o text-blue-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">基础素材.xls</div>
                    <div class="text-xs text-neutral-500">2023-02-28 14:30 上传</div>
                  </div>
                </div>
              </div>
              
              <div class="bg-white border border-neutral-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer relative">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa fa-file-video-o text-blue-600 text-xl"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-neutral-800 mb-1 truncate">周一上午—产品内部培训知识库.xls</div>
                    <div class="text-xs text-neutral-500">2023-02-27 09:20 上传</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 5. 流程引擎 -->
          <div class="hidden flex flex-col h-[calc(100vh-200px)]" id="workflow-engine-tab">
            <!-- 顶部导航栏 -->
            <div class="bg-neutral-50 border-b border-neutral-200 px-6 py-3 flex items-center justify-between flex-shrink-0">
              <div class="flex items-center gap-4">
                <button class="text-neutral-600 hover:text-neutral-900">
                  <i class="fa fa-chevron-left mr-2"></i>流程引擎
                </button>
                <span class="text-xs text-neutral-500">已自动保存 14:28:36</span>
              </div>
              <div class="flex items-center gap-2">
                <button class="px-3 py-1.5 bg-neutral-200 text-neutral-700 rounded text-sm hover:bg-neutral-300">事件</button>
                <button class="px-3 py-1.5 bg-neutral-200 text-neutral-700 rounded text-sm hover:bg-neutral-300">会话属性</button>
              </div>
            </div>
            
            <!-- 主内容区域 -->
            <div class="flex flex-1 overflow-hidden">
              <!-- 左侧节点面板 -->
              <div class="w-64 bg-white border-r border-neutral-200 overflow-y-auto p-4">
                <!-- 触发器节点 -->
                <div class="mb-6">
                  <div class="bg-blue-500 text-white px-3 py-2 rounded-t-lg font-medium text-sm mb-2">触发器节点</div>
                  <div class="bg-white border border-neutral-200 rounded-b-lg p-2 space-y-2">
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-comment text-blue-500"></i>
                        <span class="text-sm">接收消息</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-tag text-blue-500"></i>
                        <span class="text-sm">标签变更</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-user-plus text-blue-500"></i>
                        <span class="text-sm">新加好友</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-users text-blue-500"></i>
                        <span class="text-sm">入&离群事件</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-refresh text-blue-500"></i>
                        <span class="text-sm">回调事件</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="text-xs text-neutral-500 p-2 text-center">更多节点...</div>
                  </div>
                </div>
                
                <!-- 计算节点 -->
                <div class="mb-6">
                  <div class="bg-green-500 text-white px-3 py-2 rounded-t-lg font-medium text-sm mb-2">计算节点</div>
                  <div class="bg-white border border-neutral-200 rounded-b-lg p-2 space-y-2">
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-brain text-green-500"></i>
                        <span class="text-sm">大模型生成</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-puzzle-piece text-green-500"></i>
                        <span class="text-sm">插件应用</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-book text-green-500"></i>
                        <span class="text-sm">查询知识库</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <span class="text-green-500 font-bold text-xs">JS</span>
                        <span class="text-sm">JS代码块</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-list text-green-500"></i>
                        <span class="text-sm">数组遍历</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-gavel text-green-500"></i>
                        <span class="text-sm">规则中心</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="text-xs text-neutral-500 p-2 text-center">更多节点中...</div>
                  </div>
                </div>
                
                <!-- 动作节点 -->
                <div class="mb-6">
                  <div class="bg-purple-500 text-white px-3 py-2 rounded-t-lg font-medium text-sm mb-2">动作节点</div>
                  <div class="bg-white border border-neutral-200 rounded-b-lg p-2 space-y-2">
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-paper-plane text-purple-500"></i>
                        <span class="text-sm">发送消息</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-tags text-purple-500"></i>
                        <span class="text-sm">标签操作</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-group text-purple-500"></i>
                        <span class="text-sm">拉群</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-headphones text-purple-500"></i>
                        <span class="text-sm">转人工</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-equals text-purple-500"></i>
                        <span class="text-sm">赋值</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-bell text-purple-500"></i>
                        <span class="text-sm">事件</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-50 rounded cursor-pointer">
                      <div class="flex items-center gap-2">
                        <i class="fa fa-puzzle-piece text-purple-500"></i>
                        <span class="text-sm">插件应用</span>
                      </div>
                      <button class="text-primary text-xs">+</button>
                    </div>
                    <div class="text-xs text-neutral-500 p-2 text-center">更多节点...</div>
                  </div>
                </div>
              </div>
              
              <!-- 右侧流程画布 -->
              <div class="flex-1 bg-neutral-50 relative overflow-auto" style="background-image: radial-gradient(circle, #d1d5db 1px, transparent 1px); background-size: 20px 20px;">
                <!-- 顶部操作栏 -->
                <div class="absolute top-4 right-4 z-10 flex items-center gap-2">
                  <button class="px-3 py-1.5 bg-white border border-neutral-300 rounded text-sm hover:bg-neutral-50">会话属性</button>
                  <button class="px-3 py-1.5 bg-white border border-neutral-300 rounded text-sm hover:bg-neutral-50">试运行</button>
                  <button class="px-3 py-1.5 bg-primary text-white rounded text-sm hover:bg-primary/90">发布</button>
                  <button class="px-3 py-1.5 bg-primary text-white rounded text-sm hover:bg-primary/90">启用</button>
                </div>
                
                <!-- 流程节点 -->
                <div class="p-8 min-w-full min-h-full relative" style="padding-top: 60px;">
                  <!-- 节点1: 接收文本消息 -->
                  <div class="absolute" style="left: 80px; top: 200px;">
                    <div class="bg-white border-2 border-blue-500 rounded-lg shadow-lg w-64 relative">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                          <i class="fa fa-comment text-blue-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">接收文本消息</h4>
                        </div>
                        <div class="text-xs text-neutral-600 space-y-1 mb-3">
                          <div>文本: text</div>
                          <div class="flex items-center gap-1">
                            接收渠道: 网页
                            <i class="fa fa-globe text-xs"></i>
                          </div>
                        </div>
                        <div class="text-xs text-neutral-500 mb-2">可接收其他渠道:</div>
                        <div class="flex gap-2">
                          <i class="fa fa-music text-neutral-400"></i>
                          <i class="fa fa-weixin text-neutral-400"></i>
                          <i class="fa fa-weixin text-neutral-400"></i>
                          <i class="fa fa-qq text-neutral-400"></i>
                        </div>
                      </div>
                      <!-- 输出端口 -->
                      <div class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 w-4 h-4 bg-blue-500 rounded-full border-2 border-white z-10"></div>
                    </div>
                    <!-- 连接线（箭头） -->
                    <div class="absolute left-full top-1/2 flex items-center" style="left: 272px; width: 80px;">
                      <div class="h-0.5 bg-blue-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-blue-500 text-xs"></i>
                    </div>
                  </div>
                  
                  <!-- 节点2: 规则中心 -->
                  <div class="absolute" style="left: 420px; top: 160px;">
                    <div class="bg-white border-2 border-green-500 rounded-lg shadow-lg w-72 relative">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-2">
                          <i class="fa fa-gavel text-green-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">规则中心</h4>
                        </div>
                        <p class="text-xs text-neutral-500 mb-3">通过判定条件进入指定流程</p>
                        <!-- 输出分支 -->
                        <div class="space-y-2">
                          <div class="flex items-center justify-between text-xs">
                            <span class="text-neutral-600">感谢话术</span>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                          </div>
                          <div class="flex items-center justify-between text-xs">
                            <span class="text-neutral-600">投诉话术</span>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                          </div>
                          <div class="flex items-center justify-between text-xs">
                            <span class="text-neutral-600">咨询话术</span>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                          </div>
                          <div class="flex items-center justify-between text-xs">
                            <span class="text-neutral-600">else</span>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                          </div>
                        </div>
                        <button class="mt-3 text-xs text-primary hover:text-primary/80 w-full text-left">+ 添加新分支</button>
                      </div>
                      <!-- 多个输出端口 -->
                      <div class="absolute right-0 top-1/4 transform translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                      <div class="absolute right-0 top-2/4 transform translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                      <div class="absolute right-0 top-3/4 transform translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                      <div class="absolute right-0 bottom-0 transform translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                    </div>
                    <!-- 连接线（箭头）- 感谢话术（连接到发送消息） -->
                    <div class="absolute flex items-center" style="left: 708px; top: 148px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                    <!-- 连接线（箭头）- 投诉话术（连接到大模型生成） -->
                    <div class="absolute flex items-center" style="left: 708px; top: 228px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                    <!-- 连接线（箭头）- 咨询话术（连接到查询知识库） -->
                    <div class="absolute flex items-center" style="left: 708px; top: 348px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                    <!-- 连接线（箭头）- else（连接到发送消息） -->
                    <div class="absolute flex items-center" style="left: 708px; top: 468px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                  </div>
                  
                  <!-- 节点3: 发送消息（感谢话术分支） -->
                  <div class="absolute" style="left: 768px; top: 108px;">
                    <div class="bg-white border-2 border-purple-500 rounded-lg shadow-lg w-56">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                          <i class="fa fa-paper-plane text-purple-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">发送消息</h4>
                        </div>
                        <div class="text-xs text-neutral-600">您客气啦~</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 节点4: 大模型生成（投诉话术分支） -->
                  <div class="absolute" style="left: 768px; top: 228px;">
                    <div class="bg-white border-2 border-green-500 rounded-lg shadow-lg w-64 relative">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                          <i class="fa fa-brain text-green-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">大模型生成</h4>
                        </div>
                        <div class="text-xs text-neutral-600 space-y-1 mb-3">
                          <div>输入: user_question</div>
                          <div>input</div>
                          <div>模型版本: GPT-4</div>
                          <div>引用历史: 开启</div>
                          <div>JSON: 开启</div>
                        </div>
                      </div>
                      <!-- 输出端口 -->
                      <div class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                    </div>
                    <!-- 连接线（箭头） -->
                    <div class="absolute left-full top-1/2 flex items-center" style="left: 960px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                    <!-- 后续发送消息节点 -->
                    <div class="absolute" style="left: 1028px; top: 228px;">
                      <div class="bg-white border-2 border-purple-500 rounded-lg shadow-lg w-56">
                        <div class="p-4">
                          <div class="flex items-center gap-2 mb-3">
                            <i class="fa fa-paper-plane text-purple-500 text-lg"></i>
                            <h4 class="font-semibold text-sm">发送消息</h4>
                          </div>
                          <div class="text-xs text-neutral-600">文本: text</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 节点5: 查询知识库（咨询话术分支） -->
                  <div class="absolute" style="left: 768px; top: 348px;">
                    <div class="bg-white border-2 border-green-500 rounded-lg shadow-lg w-64 relative">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                          <i class="fa fa-book text-green-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">查询知识库</h4>
                        </div>
                        <div class="text-xs text-neutral-600 space-y-1 mb-3">
                          <div>输入: user_question</div>
                          <div>选择知识库: 产品咨询</div>
                          <div>结构条数: 不限</div>
                          <div>查询阈值: 85%</div>
                        </div>
                      </div>
                      <!-- 输出端口 -->
                      <div class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-1/2 w-4 h-4 bg-green-500 rounded-full border-2 border-white z-10"></div>
                    </div>
                    <!-- 连接线（箭头） -->
                    <div class="absolute left-full top-1/2 flex items-center" style="left: 960px; width: 60px;">
                      <div class="h-0.5 bg-green-500 flex-1"></div>
                      <i class="fa fa-arrow-right text-green-500 text-xs"></i>
                    </div>
                    <!-- 后续发送消息节点 -->
                    <div class="absolute" style="left: 1028px; top: 348px;">
                      <div class="bg-white border-2 border-purple-500 rounded-lg shadow-lg w-56">
                        <div class="p-4">
                          <div class="flex items-center gap-2 mb-3">
                            <i class="fa fa-paper-plane text-purple-500 text-lg"></i>
                            <h4 class="font-semibold text-sm">发送消息</h4>
                          </div>
                          <div class="text-xs text-neutral-600">文本: text</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 节点6: 发送消息（else分支） -->
                  <div class="absolute" style="left: 768px; top: 468px;">
                    <div class="bg-white border-2 border-purple-500 rounded-lg shadow-lg w-56">
                      <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                          <i class="fa fa-paper-plane text-purple-500 text-lg"></i>
                          <h4 class="font-semibold text-sm">发送消息</h4>
                        </div>
                        <div class="text-xs text-neutral-600">请问需要什么帮助吗?</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- 底部控制栏 -->
                <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center gap-3 bg-white px-4 py-2 rounded-lg shadow-lg border border-neutral-200">
                  <button class="text-neutral-600 hover:text-neutral-900"><i class="fa fa-th"></i></button>
                  <button class="text-neutral-600 hover:text-neutral-900"><i class="fa fa-expand"></i></button>
                  <div class="flex items-center gap-2 border-l border-r border-neutral-200 px-3">
                    <button class="text-neutral-600 hover:text-neutral-900">-</button>
                    <span class="text-xs text-neutral-600">100%</span>
                    <button class="text-neutral-600 hover:text-neutral-900">+</button>
                  </div>
                  <button class="text-neutral-600 hover:text-neutral-900"><i class="fa fa-chevron-left"></i></button>
                  <button class="text-neutral-600 hover:text-neutral-900"><i class="fa fa-chevron-right"></i></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 交互流程（占位，可保留） -->
  <section id="workflow" class="py-16 bg-neutral-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-center mb-4 text-neutral-800">交互流程</h2>
      <p class="text-center text-neutral-600 max-w-3xl mx-auto">此处展示从「客户接待→需求澄清→方案推荐→异议处理→转化→督学」的高层流程示意。</p>
    </div>
  </section>

  <!-- 全局脚本：TAB/子TAB/卡片/按钮交互、移动端菜单等 -->
  <script>
    // 移动端菜单
    const mobileBtn = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileBtn && mobileMenu) {
      mobileBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // 后台TAB切换
    const backendTabs = document.getElementById('backend-tabs');
    const tabButtons = backendTabs ? backendTabs.querySelectorAll('button[data-tab]') : [];
    const tabViews = {
      'task-center': document.getElementById('task-center-tab'),
      'group-portrait': document.getElementById('group-portrait-tab'),
      'ai-config': document.getElementById('ai-config-tab'),
      'knowledge-base': document.getElementById('knowledge-base-tab'),
      'workflow-engine': document.getElementById('workflow-engine-tab')
    };
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => {
          b.classList.remove('tab-active', 'border-primary', 'text-primary', 'font-medium');
          b.classList.add('border-transparent', 'text-neutral-600');
        });
        btn.classList.add('tab-active', 'border-primary', 'text-primary', 'font-medium');
        btn.classList.remove('border-transparent', 'text-neutral-600');
        Object.values(tabViews).forEach(v => v && v.classList.add('hidden'));
        const key = btn.getAttribute('data-tab');
        if (key && tabViews[key]) tabViews[key].classList.remove('hidden');
      });
    });

    // 任务中心子TAB
    const taskSubTabs = document.getElementById('task-subtabs');
    if (taskSubTabs) {
      const subBtns = taskSubTabs.querySelectorAll('button[data-subtab]');
      const subViews = {
        'customer-follow': document.getElementById('customer-follow-tab'),
        'operation-task': document.getElementById('operation-task-tab')
      };
      subBtns.forEach(b => {
        b.addEventListener('click', () => {
          subBtns.forEach(x => x.classList.remove('text-primary','border-primary','font-medium'));
          b.classList.add('text-primary','border-primary','font-medium');
          Object.values(subViews).forEach(v => v && v.classList.add('hidden'));
          const k = b.getAttribute('data-subtab');
          if (k && subViews[k]) subViews[k].classList.remove('hidden');
        });
      });
    }

    // AI配置子TAB
    const aiConfigSubTabs = document.getElementById('ai-config-subtabs');
    if (aiConfigSubTabs) {
      const subBtns = aiConfigSubTabs.querySelectorAll('button[data-subtab]');
      const subViews = {
        'ai-switches': document.getElementById('ai-switches-tab'),
        'style-adjust': document.getElementById('style-adjust-tab')
      };
      subBtns.forEach(b => {
        b.addEventListener('click', () => {
          subBtns.forEach(x => x.classList.remove('text-primary','border-primary','font-medium'));
          b.classList.add('text-primary','border-primary','font-medium');
          Object.values(subViews).forEach(v => v && v.classList.add('hidden'));
          const k = b.getAttribute('data-subtab');
          if (k && subViews[k]) subViews[k].classList.remove('hidden');
        });
      });
    }

    // 群体画像：点击卡片更新下方客户列表标题
    const groupTitle = document.querySelector('#group-portrait-tab h4');
    const listTitle = document.querySelector('#group-portrait-tab h4');
    const listHeader = document.querySelector('#group-portrait-tab + div h4');
    const highIntentCard = document.getElementById('high-intent-card');
    function setListTitle(text){
      const container = document.querySelector('#group-portrait-tab').parentElement;
      const titleEl = container.querySelector('h4');
      const headerEl = container.querySelector('div > div > h4');
      const tablesection = container.querySelector('table');
      const titleBar = container.querySelectorAll('h4')[0];
      const listBar = container.querySelectorAll('h4')[1];
      if (listBar) listBar.textContent = text + '列表';
    }
    document.querySelectorAll('#group-portrait-tab .card-hover button').forEach((btn) => {
      btn.addEventListener('click', () => {
        const parent = btn.closest('.card-hover');
        if (!parent) return;
        const title = parent.querySelector('h4')?.textContent || '客户';
        const container = document.getElementById('group-portrait-tab');
        const listBar = container.parentElement.querySelectorAll('h4')[1];
        if (listBar) listBar.textContent = title + '列表';
        container.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });

    // 任务中心按钮交互（分配AI/手动完成）
    function toast(msg){
      const el = document.createElement('div');
      el.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 bg-neutral-800 text-white text-sm px-3 py-2 rounded shadow z-50';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 1600);
    }
    document.querySelectorAll('#task-center-tab button').forEach(btn => {
      if (btn.textContent.includes('分配AI')) {
        btn.addEventListener('click', () => toast('已分配给AI执行'));
      }
      if (btn.textContent.includes('手动完成')) {
        btn.addEventListener('click', () => toast('已标记为完成'));
      }
    });

    // 开关滑块：显示温度值
    document.querySelectorAll('.ai-temp').forEach(range => {
      const valueEl = range.parentElement.querySelector('.temp-value');
      range.addEventListener('input', () => {
        if (valueEl) valueEl.textContent = range.value;
      });
    });

    // 监察者温度滑块：显示温度值（1-10分）
    document.querySelectorAll('.ai-temp-supervisor').forEach(range => {
      const valueEl = range.parentElement.querySelector('.temp-value');
      range.addEventListener('input', () => {
        if (valueEl) valueEl.textContent = range.value;
      });
    });

    // AI任务分支：挖需/督学模式切换
    const needsFlow = document.getElementById('needs-flow');
    const supervisionFlow = document.getElementById('supervision-flow');
    const taskModeButtons = document.querySelectorAll('button[data-mode]');
    const stuckActions = document.getElementById('stuck-node-actions');
    
    taskModeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = btn.getAttribute('data-mode');
        // 更新按钮状态
        taskModeButtons.forEach(b => {
          b.classList.remove('active-task-mode', 'bg-primary/10', 'text-primary', 'font-medium');
          b.classList.add('text-neutral-500');
        });
        btn.classList.add('active-task-mode');
        btn.classList.remove('text-neutral-500');
        
        // 切换流程显示
        if (mode === 'needs') {
          needsFlow.classList.remove('hidden');
          supervisionFlow.classList.add('hidden');
          setTimeout(() => {
            updateProgressAndMarkers(needsFlow);
            bindNodeActionButtons();
          }, 100);
        } else if (mode === 'supervision') {
          needsFlow.classList.add('hidden');
          supervisionFlow.classList.remove('hidden');
          setTimeout(() => {
            updateProgressAndMarkers(supervisionFlow);
            bindNodeActionButtons();
          }, 100);
        }
      });
    });

    // 节点状态管理：监听节点状态变化，显示卡住操作按钮
    function updateNodeStatus(node, status) {
      // 移除所有状态类
      node.classList.remove('node-completed', 'node-active', 'node-pending', 'node-stuck');
      
      if (status === 'completed') {
        node.classList.add('node-completed');
        const icon = node.querySelector('.node-icon');
        if (icon) {
          icon.innerHTML = '<i class="fa fa-check-circle"></i>';
          icon.className = 'node-icon bg-green-100 text-green-600';
        }
        const statusEl = node.querySelector('.node-status');
        if (statusEl) statusEl.textContent = '已完成';
      } else if (status === 'active') {
        node.classList.add('node-active');
        const icon = node.querySelector('.node-icon');
        if (icon) {
          icon.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
        }
        const statusEl = node.querySelector('.node-status');
        if (statusEl) {
          statusEl.textContent = '运行中';
          statusEl.className = 'node-status text-primary';
        }
      } else if (status === 'stuck') {
        node.classList.add('node-stuck');
        const icon = node.querySelector('.node-icon');
        if (icon) {
          icon.innerHTML = '<i class="fa fa-exclamation-triangle"></i>';
          icon.className = 'node-icon bg-warning/20 text-warning';
        }
        const statusEl = node.querySelector('.node-status');
        if (statusEl) {
          statusEl.textContent = '卡住';
          statusEl.className = 'node-status text-warning';
        }
        // 显示操作按钮
        if (stuckActions) {
          stuckActions.classList.remove('hidden');
          // 滚动到操作按钮
          setTimeout(() => {
            stuckActions.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 100);
        }
      } else {
        node.classList.add('node-pending');
        const statusEl = node.querySelector('.node-status');
        if (statusEl) {
          statusEl.textContent = '待执行';
          statusEl.className = 'node-status text-neutral-500';
        }
      }
    }

    // 操作按钮事件
    if (stuckActions) {
      const wakeBtn = stuckActions.querySelector('button:first-child');
      const digBtn = stuckActions.querySelector('button:nth-child(2)');
      const followBtn = stuckActions.querySelector('button:last-child');
      
      if (wakeBtn) {
        wakeBtn.addEventListener('click', () => {
          toast('已发送唤醒指令');
          // 找到当前卡住的节点，恢复运行
          const stuckNode = document.querySelector('.node-stuck');
          if (stuckNode) {
            updateNodeStatus(stuckNode, 'active');
            stuckActions.classList.add('hidden');
          }
        });
      }
      
      if (digBtn) {
        digBtn.addEventListener('click', () => {
          toast('已触发二次挖需');
          // 重新执行挖需流程
          const firstPendingNode = document.querySelector('.node-pending');
          if (firstPendingNode) {
            updateNodeStatus(firstPendingNode, 'active');
            stuckActions.classList.add('hidden');
          }
        });
      }
      
      if (followBtn) {
        followBtn.addEventListener('click', () => {
          toast('已按进度跟进任务');
          // 找到下一个待执行节点并激活
          const stuckNode = document.querySelector('.node-stuck');
          if (stuckNode) {
            const nextNode = stuckNode.closest('.degree-section').nextElementSibling?.querySelector('.flow-node');
            if (nextNode && nextNode.classList.contains('node-pending')) {
              updateNodeStatus(stuckNode, 'completed');
              updateNodeStatus(nextNode, 'active');
              stuckActions.classList.add('hidden');
            }
          }
        });
      }
    }

    // 为节点内的操作按钮绑定事件（继续、唤醒）
    function bindNodeActionButtons() {
      // 继续按钮
      document.querySelectorAll('.action-continue').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          toast('已继续执行任务');
          const stuckNode = btn.closest('.node-stuck');
          if (stuckNode) {
            updateNodeStatus(stuckNode, 'active');
            // 隐藏按钮
            const actionBtns = stuckNode.querySelector('.flex.gap-1\\.5');
            if (actionBtns) actionBtns.remove();
            // 更新进度
            const flowContainer = stuckNode.closest('.ai-task-flow');
            if (flowContainer) updateProgressAndMarkers(flowContainer);
          }
        });
      });
      
      // 唤醒按钮
      document.querySelectorAll('.action-wake').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          toast('已发送唤醒指令');
          const stuckNode = btn.closest('.node-stuck');
          if (stuckNode) {
            updateNodeStatus(stuckNode, 'active');
            // 隐藏按钮
            const actionBtns = stuckNode.querySelector('.flex.gap-1\\.5');
            if (actionBtns) actionBtns.remove();
            // 更新进度
            const flowContainer = stuckNode.closest('.ai-task-flow');
            if (flowContainer) updateProgressAndMarkers(flowContainer);
          }
        });
      });
    }

    // 更新进度轴和节点标记
    function updateProgressAndMarkers(flowContainer) {
      if (!flowContainer) return;
      
      const sections = flowContainer.querySelectorAll('.degree-section');
      let activeIndex = -1;
      let stuckIndex = -1;
      
      sections.forEach((section, index) => {
        const marker = section.querySelector('.node-marker');
        const node = section.querySelector('.flow-node.node-completed, .flow-node.node-active, .flow-node.node-stuck');
        const branchNode = section.querySelector('.branch-node.node-active');
        
        // 保存标记器的原始文本（如果有自定义文本）
        const originalText = marker?.textContent || '';
        const hasCustomText = originalText.length > 1 || isNaN(parseInt(originalText));
        
        if (node) {
          if (node.classList.contains('node-completed')) {
            if (marker) {
              marker.className = 'node-marker completed';
              if (!hasCustomText) marker.textContent = index;
            }
          } else if (node.classList.contains('node-active')) {
            if (marker) {
              marker.className = 'node-marker active';
              if (!hasCustomText) marker.textContent = index;
            }
            activeIndex = index;
          } else if (node.classList.contains('node-stuck')) {
            if (marker) {
              marker.className = 'node-marker stuck';
              if (!hasCustomText) marker.textContent = index;
            }
            stuckIndex = index;
          } else {
            if (marker) {
              marker.className = 'node-marker pending';
              if (!hasCustomText) marker.textContent = index;
            }
          }
        } else if (branchNode && index === 0) {
          // DEGREE 0的特殊情况，分支节点激活
          if (marker) {
            marker.className = 'node-marker active';
            if (!hasCustomText) marker.textContent = index;
          }
          activeIndex = index;
        } else {
          if (marker) {
            marker.className = 'node-marker pending';
            if (!hasCustomText) marker.textContent = index;
          }
        }
      });
      
      // 更新进度轴
      const progressAxis = flowContainer.querySelector('.progress-axis-line');
      if (progressAxis && sections.length > 0) {
        const currentIndex = stuckIndex >= 0 ? stuckIndex : activeIndex;
        if (currentIndex >= 0) {
          const progressPercent = ((currentIndex + 1) / sections.length) * 100;
          progressAxis.style.setProperty('--progress-height', progressPercent + '%');
        }
      }
    }

    // 页面加载时初始化
    function initializeTaskFlow() {
      const activeFlow = document.querySelector('.ai-task-flow:not(.hidden)');
      if (activeFlow) {
        updateProgressAndMarkers(activeFlow);
        bindNodeActionButtons();
      }
    }
    initializeTaskFlow();

    // 侧边栏TAB切换
    const sidebarTabButtons = document.querySelectorAll('.sidebar-tab-btn');
    const sidebarTabContents = {
      'profile': document.getElementById('sidebar-profile-tab'),
      'ai-assistant': document.getElementById('sidebar-ai-assistant-tab')
    };
    
    sidebarTabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.getAttribute('data-sidebar-tab');
        // 更新按钮状态
        sidebarTabButtons.forEach(b => {
          b.classList.remove('active', 'border-primary', 'text-primary');
          b.classList.add('border-transparent', 'text-neutral-500');
        });
        btn.classList.add('active', 'border-primary', 'text-primary');
        btn.classList.remove('border-transparent', 'text-neutral-500');
        
        // 切换内容显示
        Object.values(sidebarTabContents).forEach(content => {
          if (content) content.classList.add('hidden');
        });
        if (tab && sidebarTabContents[tab]) {
          sidebarTabContents[tab].classList.remove('hidden');
        }
      });
    });

    // 监察者状态切换
    const aiStatusDiv = document.getElementById('ai-supervisor-status');
    const handoverStatusDiv = document.getElementById('handover-status');
    const handoverReasonEl = document.getElementById('handover-reason');
    const switchToAIBtn = document.getElementById('switch-to-ai-btn');
    const handoverBtn = document.getElementById('handover-to-human-btn');
    
    // 转交人工按钮
    if (handoverBtn) {
      handoverBtn.addEventListener('click', () => {
        if (aiStatusDiv) aiStatusDiv.classList.add('hidden');
        if (handoverStatusDiv) {
          handoverStatusDiv.classList.remove('hidden');
          // 可以在这里设置转交原因（实际应用中从后端获取）
          const reasonInput = prompt('请输入转交原因：', '涉及价格谈判，AI无权限处理');
          if (reasonInput && handoverReasonEl) {
            handoverReasonEl.textContent = reasonInput;
          }
        }
        toast('已转交人工处理');
      });
    }
    
    // 切换AI带班按钮
    if (switchToAIBtn) {
      switchToAIBtn.addEventListener('click', () => {
        if (handoverStatusDiv) handoverStatusDiv.classList.add('hidden');
        if (aiStatusDiv) aiStatusDiv.classList.remove('hidden');
        toast('已切换为AI带班');
      });
    }

    // 班级画像筛选功能
    const filterSelects = document.querySelectorAll('.filter-select');
    const filterScoreMin = document.querySelector('.filter-score-min');
    const filterScoreMax = document.querySelector('.filter-score-max');
    const filterTagBtns = document.querySelectorAll('.filter-tag-btn');
    const studentList = document.getElementById('class-student-list');
    
    // 标签筛选按钮点击事件
    if (filterTagBtns.length > 0) {
      filterTagBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('active-tag');
          filterStudentList();
        });
      });
      
      // 页面加载时执行一次筛选（默认高价值、高意向已激活）
      setTimeout(() => {
        filterStudentList();
      }, 100);
    }
    
    if (filterSelects.length > 0 && studentList) {
      filterSelects.forEach(select => {
        select.addEventListener('change', () => {
          filterStudentList();
        });
      });
    }
    
    if (filterScoreMin && studentList) {
      filterScoreMin.addEventListener('input', () => {
        filterStudentList();
      });
    }
    
    if (filterScoreMax && studentList) {
      filterScoreMax.addEventListener('input', () => {
        filterStudentList();
      });
    }
    
    function filterStudentList() {
      if (!studentList) return;
      
      // 获取激活的标签
      const activeTags = Array.from(filterTagBtns)
        .filter(btn => btn.classList.contains('active-tag'))
        .map(btn => btn.getAttribute('data-tag'));
      
      const filters = {
        scoreMin: filterScoreMin?.value || '',
        scoreMax: filterScoreMax?.value || '',
        aiAuto: document.querySelector('[data-filter="ai-auto"]')?.value || '',
        goal: document.querySelector('[data-filter="goal"]')?.value || '',
        occupation: document.querySelector('[data-filter="occupation"]')?.value || '',
        tags: activeTags
      };
      
      const rows = studentList.querySelectorAll('tr');
      rows.forEach(row => {
        let show = true;
        
        // 标签筛选（多选，必须匹配所有激活的标签）
        if (filters.tags.length > 0) {
          for (const tag of filters.tags) {
            const tagValue = row.getAttribute(`data-${tag}`);
            if (tagValue !== 'true') {
              show = false;
              break;
            }
          }
        }
        
        // 意向分数区间筛选
        if (show && (filters.scoreMin || filters.scoreMax)) {
          const score = parseInt(row.getAttribute('data-score')) || 0;
          const min = filters.scoreMin ? parseInt(filters.scoreMin) : 0;
          const max = filters.scoreMax ? parseInt(filters.scoreMax) : 100;
          if (score < min || score > max) {
            show = false;
          }
        }
        
        // AI接待筛选
        if (show && filters.aiAuto && row.getAttribute('data-ai-auto') !== filters.aiAuto) {
          show = false;
        }
        
        // 学习目标筛选
        if (show && filters.goal && row.getAttribute('data-goal') !== filters.goal) {
          show = false;
        }
        
        // 职业筛选
        if (show && filters.occupation && row.getAttribute('data-occupation') !== filters.occupation) {
          show = false;
        }
        
        row.style.display = show ? '' : 'none';
      });
    }

    // 整体AI开关功能
    const globalAISwitch = document.getElementById('global-ai-switch');
    const rowAISwitches = document.querySelectorAll('.row-ai-switch');
    
    if (globalAISwitch) {
      globalAISwitch.addEventListener('change', (e) => {
        const isChecked = e.target.checked;
        rowAISwitches.forEach(switchEl => {
          switchEl.checked = isChecked;
          const label = switchEl.closest('label')?.querySelector('.switch-label');
          if (label) {
            if (isChecked) {
              label.classList.remove('bg-neutral-300');
              label.classList.add('bg-primary');
              const toggle = label.querySelector('span');
              if (toggle) {
                toggle.style.left = '';
                toggle.style.right = '0.125rem';
              }
            } else {
              label.classList.remove('bg-primary');
              label.classList.add('bg-neutral-300');
              const toggle = label.querySelector('span');
              if (toggle) {
                toggle.style.right = '';
                toggle.style.left = '0';
              }
            }
          }
        });
        toast(isChecked ? '已开启所有AI功能' : '已关闭所有AI功能');
      });
    }

    // 群发按钮
    const groupSendBtns = document.querySelectorAll('button');
    let groupSendBtn = null;
    groupSendBtns.forEach(btn => {
      if (btn.querySelector('.fa-paper-plane')) {
        groupSendBtn = btn;
      }
    });
    
    if (groupSendBtn && studentList) {
      groupSendBtn.addEventListener('click', () => {
        const visibleRows = Array.from(studentList.querySelectorAll('tr')).filter(row => {
          return row.style.display !== 'none';
        });
        if (visibleRows.length === 0) {
          toast('请先筛选学员');
          return;
        }
        toast(`已为 ${visibleRows.length} 位学员创建群发任务`);
      });
    }

    // 去对话和详情按钮
    document.addEventListener('click', (e) => {
      if (e.target.textContent === '去对话') {
        toast('跳转到对话页面');
      } else if (e.target.textContent === '详情') {
        toast('打开详情页面');
      }
    });

    // 社群名称选择功能
    const communitySelector = document.getElementById('community-selector');
    const communityDisplay = document.querySelector('.community-selector-display');
    const communityDropdown = document.getElementById('community-dropdown');
    const communityCheckboxes = document.querySelectorAll('.community-checkbox');
    
    let selectedCommunities = ['Python进阶班2024', 'Java基础班2024', '数据分析班2024'];
    
    // 初始化显示
    if (communityDisplay) {
      // 移除HTML中硬编码的标签，保留"+ 选择"文本
      const hardcodedTags = communityDisplay.querySelectorAll('span:not(.text-xs)');
      hardcodedTags.forEach(tag => {
        if (!tag.classList.contains('text-neutral-400')) {
          tag.remove();
        }
      });
      updateCommunityDisplay();
    }
    
    // 点击显示下拉框
    if (communityDisplay && communityDropdown) {
      communityDisplay.addEventListener('click', (e) => {
        e.stopPropagation();
        communityDropdown.classList.toggle('hidden');
      });
      
      // 点击外部关闭下拉框
      document.addEventListener('click', (e) => {
        if (!communitySelector?.contains(e.target)) {
          communityDropdown?.classList.add('hidden');
        }
      });
    }
    
    // 复选框变化处理
    if (communityCheckboxes.length > 0) {
      communityCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', (e) => {
          const value = e.target.value;
          const isChecked = e.target.checked;
          
          if (isChecked) {
            if (selectedCommunities.length >= 3) {
              e.target.checked = false;
              toast('最多只能选择3个社群');
              return;
            }
            if (!selectedCommunities.includes(value)) {
              selectedCommunities.push(value);
            }
          } else {
            selectedCommunities = selectedCommunities.filter(c => c !== value);
          }
          
          updateCommunityDisplay();
        });
      });
    }
    
    // 移除社群
    window.removeCommunity = function(name) {
      selectedCommunities = selectedCommunities.filter(c => c !== name);
      const checkbox = Array.from(communityCheckboxes).find(cb => cb.value === name);
      if (checkbox) {
        checkbox.checked = false;
      }
      updateCommunityDisplay();
    };
    
    // 更新显示
    function updateCommunityDisplay() {
      if (!communityDisplay) return;
      
      // 清空现有标签
      const existingTags = communityDisplay.querySelectorAll('span[data-community]');
      existingTags.forEach(tag => tag.remove());
      
      // 添加选中的标签
      selectedCommunities.forEach(name => {
        const tag = document.createElement('span');
        tag.className = 'px-2 py-1 bg-primary/10 text-primary text-xs rounded-full font-medium flex items-center gap-1';
        tag.setAttribute('data-community', name);
        tag.innerHTML = `
          ${name}
          <button class="text-primary hover:text-primary/80" onclick="event.stopPropagation(); removeCommunity('${name}');">
            <i class="fa fa-times text-xs"></i>
          </button>
        `;
        communityDisplay.insertBefore(tag, communityDisplay.lastElementChild);
      });
      
      // 如果没有选中任何社群，显示提示
      if (selectedCommunities.length === 0) {
        const placeholder = document.createElement('span');
        placeholder.className = 'text-xs text-neutral-400';
        placeholder.textContent = '请选择社群';
        communityDisplay.insertBefore(placeholder, communityDisplay.lastElementChild);
      }
    }
    
    // 开班时间编辑功能
    function initEditClassTime() {
      const editClassTimeBtn = document.getElementById('edit-class-time-btn');
      if (editClassTimeBtn) {
        editClassTimeBtn.addEventListener('click', function handleEdit() {
          const timeDisplay = this.previousElementSibling;
          if (timeDisplay && timeDisplay.tagName === 'SPAN') {
            const currentDate = timeDisplay.textContent;
            const input = document.createElement('input');
            input.type = 'date';
            // 将日期格式转换为 YYYY-MM-DD
            const dateStr = currentDate.replace(/\//g, '-');
            input.value = dateStr.includes('-') ? dateStr : currentDate;
            input.className = 'text-sm border border-neutral-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-primary';
            
            const saveBtn = document.createElement('button');
            saveBtn.className = 'text-xs text-primary hover:text-primary/80 ml-1';
            saveBtn.innerHTML = '<i class="fa fa-check"></i> 保存';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'text-xs text-neutral-500 hover:text-neutral-700 ml-1';
            cancelBtn.innerHTML = '<i class="fa fa-times"></i> 取消';
            
            const parent = timeDisplay.parentElement;
            parent.replaceChild(input, timeDisplay);
            parent.replaceChild(saveBtn, this);
            parent.appendChild(cancelBtn);
            
            saveBtn.addEventListener('click', () => {
              const newDate = input.value;
              const dateSpan = document.createElement('span');
              dateSpan.className = 'text-sm font-medium';
              dateSpan.textContent = newDate.replace(/-/g, '-');
              
              const editBtn = document.createElement('button');
              editBtn.className = 'text-xs text-primary hover:text-primary/80 ml-1';
              editBtn.id = 'edit-class-time-btn';
              editBtn.innerHTML = '<i class="fa fa-pencil"></i> 修改';
              
              parent.replaceChild(dateSpan, input);
              parent.replaceChild(editBtn, saveBtn);
              parent.removeChild(cancelBtn);
              
              // 重新初始化编辑功能
              initEditClassTime();
              
              toast('开班时间已更新');
            });
            
            cancelBtn.addEventListener('click', () => {
              const dateSpan = document.createElement('span');
              dateSpan.className = 'text-sm font-medium';
              dateSpan.textContent = currentDate;
              
              const editBtn = document.createElement('button');
              editBtn.className = 'text-xs text-primary hover:text-primary/80 ml-1';
              editBtn.id = 'edit-class-time-btn';
              editBtn.innerHTML = '<i class="fa fa-pencil"></i> 修改';
              
              parent.replaceChild(dateSpan, input);
              parent.replaceChild(editBtn, saveBtn);
              parent.removeChild(cancelBtn);
              
              // 重新初始化编辑功能
              initEditClassTime();
            });
            
            input.focus();
          }
        });
      }
    }
    
    initEditClassTime();
  </script>

</body>
</html>
